<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>闻道</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://itjinkui.github.io/"/>
  <updated>2017-12-13T08:12:31.000Z</updated>
  <id>https://itjinkui.github.io/</id>
  
  <author>
    <name>千古不见一人闲</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>redis技术交流</title>
    <link href="https://itjinkui.github.io/2017/12/12/redis%E6%8A%80%E6%9C%AF%E4%BA%A4%E6%B5%81/"/>
    <id>https://itjinkui.github.io/2017/12/12/redis技术交流/</id>
    <published>2017-12-12T08:56:14.000Z</published>
    <updated>2017-12-13T08:12:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>redis原理与实战，不定期更新</strong><br>Redis是业界普遍应用的缓存组件，研究一个组件框架，就要探究它的设计哲学。<br><a href="https://redis.io/" target="_blank" rel="external">https://redis.io/</a></p>
<a id="more"></a>
<p>系列文章有些是从Redis源码，有些是从数据结构、内存优化、持久化、Redis集群实现原理探讨开来。<br>总之，很是流行，有必要多方位了解一下啦。</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/3TU9qxHJyxHJgVDaYXoluA" target="_blank" rel="external">张铁蕾</a> </li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzAwNjQwNzU2NQ==&amp;mid=2650342814&amp;idx=1&amp;sn=aba5c247a8c726cea3a86bac64d4a339&amp;scene=1&amp;srcid=0727YNxfwO2zzZlW7AVplGMN&amp;key=8dcebf9e179c9f3a7a34a51b0f07d506dbdf1c1ae28cc0442d989767a2f2950aa11e97ab9520b605645d5c50300a9a04&amp;ascene=0&amp;uin=MzM4Njg2NDU1" target="_blank" rel="external">Redis压缩列表原理与应用分析</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA3MzYwNjQ3NA==&amp;mid=2651296996&amp;idx=2&amp;sn=5f4811d73e74e2a63b1cb0d3d532862a&amp;scene=1&amp;srcid=08093FVw9nBy03Mw6q8cQ2ve&amp;key=305bc10ec50ec19b181b6479be2fe231b9a856f8340733ac56e3be07b30620799c45272a9f52e6c215f0868e122e2517&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">深入浅出Redis Cluster原理</a>&amp;version=11020201&amp;pass_ticket=YBk2ujYh4XjbsRV4RktshkN5XvslbbH8Wmh6W%2FK0gNKZKoeFIXdjzh2JWQjMtYmI)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzAxMTEyOTQ5OQ==&amp;mid=402004912&amp;idx=1&amp;sn=7517696a86f54262e60e1b5636d6cbe0&amp;scene=1&amp;srcid=0521HB3pYYfb5rwuUr19GmB5#rd" target="_blank" rel="external">Redis 集群的合纵与连横</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653547160&amp;idx=1&amp;sn=befd195e2aa788775aaf1cc3b6f6fab3&amp;scene=1&amp;srcid=051242VSB3OeDvn9GbmJ2QY0#rd" target="_blank" rel="external">360开源的类Redis存储系统:Pika</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODQ2MDIyMA==&amp;mid=2650712266&amp;idx=1&amp;sn=54d909d240eb701ae48467dc798ddc7f&amp;scene=1&amp;srcid=0506xZXTUptwNdQOqmeVNjjK#rd" target="_blank" rel="external">动态追踪技术（中） - Dtrace、SystemTap、火焰图</a></li>
<li><a href="https://github.com/QConChina/QConShanghai2016" target="_blank" rel="external">QCon上海2016的幻灯片合集</a></li>
<li><a href="http://ppt.geekbang.org/qconbj2016?amp;amp;isappinstalled=0&amp;amp;amp;isappinstalled=0&amp;amp;from=timeline&amp;amp;isappinstalled=0&amp;from=timeline&amp;isappinstalled=0" target="_blank" rel="external">QCon北京2016幻灯片下载合集</a></li>
<li><a href="http://ppt.geekbang.org/qconsh2017" target="_blank" rel="external">QCon 上海 2017 PPT 合集</a></li>
<li><a href="https://m.aliyun.com/yunqi/articles/58703?from=singlemessage&amp;isappinstalled=1" target="_blank" rel="external">Redis源码学习(云栖社区)</a></li>
<li><a href="http://www.cnblogs.com/wxisme/p/5742456.html" target="_blank" rel="external">基于Redis的BloomFilter算法去重</a></li>
<li><a href="http://bg2bkk.github.io/post/redis过期清除机制及应用方法" target="_blank" rel="external">redis过期清除机制及应用方法</a></li>
<li><a href="http://blog.jobbole.com/107084/" target="_blank" rel="external">由浅入深介绍 Redis LRU 策略的具体实现</a></li>
<li><a href="http://gongfuxiang.com/post-98.html" target="_blank" rel="external">Nginx+Lua+Redis搭建高并发服务</a></li>
<li><a href="https://neway6655.github.io/redis/2016/10/10/redis-hmget-deep-study.html" target="_blank" rel="external">Redis的hmget操作复杂度问题</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA3MTIyMzY4OQ==&amp;mid=2451880782&amp;idx=1&amp;sn=b4df0c48d8eca33c5e62f1d7dae51d59&amp;chksm=88e0cba8bf9742bec44ec4ca833638cab30544f38e7a589b1fb172522087bbc8f3430b1f17eb&amp;mpshare=1&amp;scene=1&amp;srcid=0122K8SAIqCcXYSBzhPqT8ns&amp;key=3c39151efb1819bded970cfff80248cde4a03c7b11ae25fb7d5799a23942c45bbd5779c0c153dccc4e2144f1f66da70763c183729975a0cebc7cdf0c3ad1a869b304b4649f2ad4d68acb9a3d13d3d6e1&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">Redis中BitMap的妙用</a>&amp;version=11020201&amp;pass_ticket=9lunQ8SqqrGnKaLWsr45Sk%2FFnwXhCKcMnV%2FUS3O6YrHLQ%2BoD4umZpFIP3vKN5Ufp)</li>
<li><a href="https://cachecloud.github.io/2017/02/16/Redis内存优化/" target="_blank" rel="external">Redis的内存优化</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&amp;mid=2649294899&amp;idx=1&amp;sn=2ff9e8f3cce96d9e2905824b25e88755&amp;chksm=f2eb99ecc59c10fa8020819b0b3fa615e55ccdd59da90462da014170afb9f2f5435b19e7612b&amp;mpshare=1&amp;scene=1&amp;srcid=0305PdxNBaitO7SroiW1500r&amp;key=ff79f90307db55eefd86d53ff042c24ed112014887030bd2df0f20adc78fa211e66eacfefbcb473cd5c28bb68031faafd1d012488ed8b8ff987b2f27e01f0c6c4dd82707e1c4d9e15ff6616e105dbae4&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">理解Redis的RESP协议</a>&amp;version=11020201&amp;pass_ticket=eoLz47Vqb%2FfYspKo69oeC249JLQFeg9c9ihsk9MIBdGZU9pJXHHsdJKQJyEv%2F1in)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&amp;mid=2650862627&amp;idx=1&amp;sn=8b679e68fdf954ebe506a1b0c68f9898&amp;chksm=8b661366bc119a70eab7fc547290e14afd614e281d11226cd700ad191f9a62d2b9033bb5c1c9&amp;mpshare=1&amp;scene=1&amp;srcid=0406U3od01SELpoubqm6D6WJ&amp;key=2ba8cc200107c8eeb80d3fa4e696b92318ec8ff2129ad47435dd8e9472fe7593496b71f6a4cce6e166edb63ad691c9d69200e163809db93ceb6b34ddbd6fdf44978d9ae5ea52d03731b7c5bf90e70b8e&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">深入学习 Redis：Redis API 的原子性分析</a>&amp;version=11020201&amp;pass_ticket=SRTXm%2BGFCVdDBsX8OggsWwJ0ZgR6EI1Yc9L0bZzPs6A37Ku019Xw3yPx4E%2BGUMGw)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=2652402586&amp;idx=1&amp;sn=84625a0e7ccc3111c43ecc084d1e6b50&amp;chksm=8bd8f57cbcaf7c6a914df6065a9f14fc3e0c81534718a0e288f3b626d5fb417cd46fcab02220&amp;mpshare=1&amp;scene=1&amp;srcid=05282qa8jvAmJHHOPbPRSipC&amp;key=00676594f04bf18d3b570d2040d1cb3980299ed23272c1965af2e9862c98ec8c11ec2781a892dc0fc3a25c564cced08783af4fa63d6584c94ce344d0c84733a314cfbaf16a97314402314f733ab74dd3&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 实现接口访问频率限制</a>&amp;version=12020610&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=nbqw40atT1DTLuVNk2Eenui04NKoqZDgxhGgwrplLF42UCPXvbTJHCJ%2BB30KUvBI)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&amp;mid=2650862802&amp;idx=1&amp;sn=93cbfe7e90bd42394065327292a5dd1e&amp;chksm=8b661397bc119a811b53577ea8112c5736f49dcb561525274635ccf41e8cf333bfdee270ae67&amp;mpshare=1&amp;scene=1&amp;srcid=0611jqfd8rjxzBHwG9NgZ4lQ&amp;key=baf732038d89126bbd2d1e562d79d2132fe1ee24dec81de52034092643c3098458c3bfe882b253c332b0524f5952082ada2a32d1307fbcab214b34227f12040fa7e4d88e57ba3a5f3c26219f18c8e087&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 源码学习之事件驱动</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=J54R9SK0IjUh4%2FNwmvNBUK07In1gt9QI2QGxkNOKs%2BGVl0IQ49v%2BuNzGOitatkoO)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&amp;mid=2650072507&amp;idx=2&amp;sn=6c744547854ee5d3d2c3fba1c8cc8729&amp;chksm=bedb3ed589acb7c3b6d4cb6be70251e0e121c6bfb65ad7212940d0426271642c8e3071147f9d&amp;mpshare=1&amp;scene=1&amp;srcid=0625cjeLQlWFOCfGt3zBELoZ&amp;key=c969774f949c279bbb596d808265d8d49d3289a2219e678651d05cbeb804f1ed66a92d0efe641dfa30eadb4dded3b8b14e1ace73c8ce07618e436640078b450d96c7a5fa1f00e1e19d686a4e3607e6b6&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 通信协议 —— 了解 Redis 客户端实现原理</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=83koKC6GRzFn%2BILm3SmMC1396AFw6e884aXwqCxhagQOiH0jdXKpM6gJj5I%2F4AVB)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NTY0MTY1OQ==&amp;mid=2654510780&amp;idx=1&amp;sn=6f6dc70cac2f0abc388416ad2e9bcb3c&amp;chksm=bd395ee88a4ed7febd78f7b48be0a875ead05acd6bd31b26b7e53e0c054362af470eac506009&amp;mpshare=1&amp;scene=1&amp;srcid=0731BMIFmJr5ouULbqVqUuww&amp;key=50814c5812fb30a2ea645e981021ee80d93e5b4f8363ffde0a15c5e43b38a4534c15d0fc115147a138bbed71c22ef93f38fb7bb95f68f65cb8a7fa598e1711dbce54697cb9293a30e7a33fea01cb9c45&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">有赞延迟队列设计</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=bnK6fL4HgEcUv4nXERfwBEsdi7Lfs7zSRaSauTQDCIbVwPgIpRAvqMQGV4Xbk8W3)</li>
<li><a href="https://yq.aliyun.com/articles/62899?spm=5176.154649.801568.9.UvJFm2" target="_blank" rel="external">Redis内存分析方法</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzE4MDI5NA==&amp;mid=2651099970&amp;idx=2&amp;sn=2f7c46f6d3041292a176f00b99c6408d&amp;chksm=8c0d82abbb7a0bbd03d9c72b1a4ba3ecb5abbb835e580dc4df1c860526369fc279e27f0e317d&amp;mpshare=1&amp;scene=1&amp;srcid=0202sJs0UhC8tzmd4MYI6ipj&amp;key=5da53c472edd2f623d25c60d0ed0d6a2e3f05fdae84124c9d52311f13eb8bf3f3030b61d6532d8154f4376a8eede05d37772b88c84aac436a1c70de980d8e4750951a46d28a263c8af60b221e9be0dff&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">redis分布式内存锁：余量扣除示例(上)</a>&amp;version=11020201&amp;pass_ticket=DPEpDdiwlvmnNCQosWeoMLFj00%2B5WgWZy07ni0NWRDM4VW53ttzKH5HcRp3LvhIu)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIxNzE4MDI5NA==&amp;mid=2651099970&amp;idx=3&amp;sn=73e0a550f9a9721e7d5a860eccb7553a&amp;chksm=8c0d82abbb7a0bbd67aad3bf59c43c8c6b4592940591c5b1768ae401236f8e85199ec4f4e68f&amp;mpshare=1&amp;scene=1&amp;srcid=0203ZK9hcahgyu919awXn5kC&amp;key=4302ad2cc7b8d1b94b5c6187aafe7796f3d05a1232bf38da306fb53bd5087e480d5e731703d57b577159ce466c9d1ea5cbf34e46bb37690339ca87a69e801a71aa1e1c22dd4afabfaed880c198b9e68c&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">redis分布式内存锁：余量扣除示例(下)</a>&amp;version=11020201&amp;pass_ticket=qsyi4k62K4Mk8ckboJNhY9Suyux5VMJx7gLKAW%2BPsbnbTjrTCcr5OLZ5u2AF6VYA)</li>
<li><a href="https://github.com/redisson/redisson/wiki/1.-%E6%A6%82%E8%BF%B0" target="_blank" rel="external">redisson</a></li>
<li><a href="https://www.zybuluo.com/sambodhi/note/642230" target="_blank" rel="external">GitHub将持久数据从Redis迁出</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548432&amp;idx=1&amp;sn=ac120e1ffca7c2007c0bc5df51e03d7b&amp;chksm=813a7e08b64df71ec7b8b6afc2a36a8ff1d780db54a395b58a9f18f084080c09de514e999834&amp;mpshare=1&amp;scene=1&amp;srcid=0324u7jGCykTaFZPCCIrwBwU&amp;key=8b1ec02b44dde3bc9a71dc40c489a145b0da63c71eaf9c1d9df4cf551f5896a6f3cab0a9797a85474ef4a63941b24a40f90bcef85195aab7fa0e3667f2ceda40b5d1758c9b33fed9d819a3ee7766bc62&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">Redis架构之防雪崩设计：网站不宕机背后的兵法</a>&amp;version=11020201&amp;pass_ticket=vKWb90vuWopMvZ8u8BmZrit4a4GPlHhnzGmcasQ3RnDZlOYPt0O9QqwIDnzcKArU)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIyNzUwMjM2MA==&amp;mid=2247484441&amp;idx=1&amp;sn=48440f228656b547929ed74ba85a7885&amp;chksm=e861746edf16fd786044354b1e361c795d58a6fc89b9c856ce7745b891fef2bf3646e40c827f&amp;scene=0&amp;pass_ticket=PWGGGfe6I2EqvdyEmHOA0RTt72D1z5ABnU2BOBKP1Jdh0uarcRrnQHhiRQouGjeE#rd" target="_blank" rel="external">千亿级高性能 KV 存储生态圈</a></li>
<li><a href="https://yq.aliyun.com/articles/68350" target="_blank" rel="external">Redis内核基于时间点的备份恢复和基于AOF日志的增量同步机制设计</a></li>
<li><a href="https://pingcap.com/blog-cn/ga-liuqi/" target="_blank" rel="external">TiDB技术内幕</a></li>
<li><a href="http://beautyboss.farbox.com/post/redis/redisyuan-ma-xue-xi-zhi-shi-jian-qu-dong" target="_blank" rel="external">Redis源码学习之事件驱动</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&amp;mid=2650862806&amp;idx=1&amp;sn=16bf30fd5c64aad16930604daf208279&amp;chksm=8b661393bc119a856418d1c70bef181b78a7fa7150cb60d380c9e5c2a15821900e4d6c4623b5&amp;scene=0&amp;key=baf732038d89126bc5ab9aed3b44ecab8fa51604bee98d093ec38f19a4b6d2cff5fe916a5dcb1ad1a1c136ff2c483be55a5e693766d10b5ced4e38f0e33305a29f3bdb87f4a0af683cb8b438a2bdde52&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">揭秘 Reddit 愚人节项目的技术实现过程</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=l9wwDByihjfEQXBTAXA8ccuuK3oSFzjDJNRG9SZpJqRaH%2FgtnHaZ4l0lvUM2esF9)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&amp;mid=2650072507&amp;idx=2&amp;sn=6c744547854ee5d3d2c3fba1c8cc8729&amp;chksm=bedb3ed589acb7c3b6d4cb6be70251e0e121c6bfb65ad7212940d0426271642c8e3071147f9d&amp;mpshare=1&amp;scene=1&amp;srcid=0625cjeLQlWFOCfGt3zBELoZ&amp;key=c969774f949c279bbb596d808265d8d49d3289a2219e678651d05cbeb804f1ed66a92d0efe641dfa30eadb4dded3b8b14e1ace73c8ce07618e436640078b450d96c7a5fa1f00e1e19d686a4e3607e6b6&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 通信协议 —— 了解 Redis 客户端实现原理</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=83koKC6GRzFn%2BILm3SmMC1396AFw6e884aXwqCxhagQOiH0jdXKpM6gJj5I%2F4AVB)</li>
<li><a href="http://blog.csdn.net/mr_smile2014/article/details/73849573" target="_blank" rel="external">redis哨兵模式使用lua脚本实现分布式锁</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjkxMjA1MA==&amp;mid=2247483746&amp;idx=1&amp;sn=9e9fe2e91f2566aac6227f93281dffc5&amp;chksm=a6e34fbf9194c6a9033270cff2535522904ca1929d95c5622e5a25603ea1b4995610a0fab373&amp;mpshare=1&amp;scene=1&amp;srcid=07046PzadWRRycnrcwjs82ut&amp;key=df6095916712388e6dfb106bdc6094ae7e3456b08613ca648eca028843d82428612d92db74de3e33fba6b7ad3301315ae79d9bfd149068405a497419e43e47880e286732d55a2722bb9062256d74e07a&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">CRUG | Redisson性能压测权威发布</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=iqAMbFo%2FIvxdIiTZGiBd%2F%2FdEf4wLij8x4w%2BtUhL%2BQD%2F1FKZ%2BLbfn4zwWKuwrgzrq)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5NjkxMjA1MA==&amp;mid=2247483772&amp;idx=1&amp;sn=51d93d22e1ed2efbff5596839d5b77df&amp;chksm=a6e34fa19194c6b7e4775eea10bfb5632458d04706ed1620dc0432f6911cc6a306b86dee26c8&amp;mpshare=1&amp;scene=1&amp;srcid=0705TBGOIAsdqlpsm3IvyoB5&amp;key=df6095916712388e5692fea773f1361740a200117ea47f983bb3c66a0975e614d1c70abd5e1c6dde416caba1a239852df63726075ac41c3259d278ed76c53f3d0b58ba3bcd8b7c6f66ca475d9db5295f&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">听滴滴大神给你讲Redis Cluster迁移遇到的坑</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=mYdTJugINDYt%2BrCxiF%2FYcu9ftJpYtOM%2BTmouv5L%2F%2BPgTiX7WRIRzN7%2BGzNwlrP9k)</li>
<li><a href="http://wangxin123.com/2017/05/27/" target="_blank" rel="external">Redis开启AOF导致的删库事件</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650762317&amp;idx=1&amp;sn=6b4efbbac812cadf2c71b1f01f4fad99&amp;chksm=f3f9d9d8c48e50cefb0f156ed38aa3ce0b09d0da75e7b1e554b8dfb2766ff28e62136235c5ae&amp;mpshare=1&amp;scene=1&amp;srcid=0717Af5ivhEcqVBmR9HOG3Te&amp;key=50814c5812fb30a2686167651785d69e98b619ac27360f7b4014b2e017f7c1b67a805e0ea5cf244a657fb92bf78b2aba38efdc2b4e2d7615b07d046ad7056d48ac419f8ae308b22c6fad5ddd6f12936c&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">唯品会海量实时OLAP分析技术升级之路</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=SbOSJ0zVKdVvlZHhx%2BUTV%2BEsc2HUNjPloRZEzd3BcM%2Bcxzs7BnsOyvF233QDYAML)</li>
<li><a href="https://m.aliyun.com/yunqi/articles/236384" target="_blank" rel="external">Jedis常见异常汇总</a></li>
<li><a href="http://www.jianshu.com/u/6df88dea0d41" target="_blank" rel="external">redis cluster 集群畅谈</a></li>
<li><a href="https://logz.io/blog/redis-performance-monitoring-elk-stack/" target="_blank" rel="external">Redis Performance Monitoring with the ELK Stack</a></li>
<li><a href="https://draveness.me/redis-io-multiplexing" target="_blank" rel="external">Redis 和 I/O 多路复用</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5ODM5MDU3MA==&amp;mid=2650863029&amp;idx=1&amp;sn=8fc43f9717ef1874a402f6c4ad777d91&amp;chksm=8b6612f0bc119be66421ff245bda2758ee603fec31020037545366ef737949f7075ccdf98386&amp;mpshare=1&amp;scene=1&amp;srcid=0904YAZ5qoO2tui27Nz7JcF2&amp;key=4dfb0b0c07ae45250e6cab821f6fdaa98793d5caf359be388b42f14bc011649a6de10084aee027baed1b3507a5e5c55d3d43c85698850afa06a8ef4abc2a28bbf23733cf549e1119acfb8f2059683ff4&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">使用 Redis 解决“树”形数据的复杂查询</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=bLBT7zfeccSIv5t%2Fl0ZTfXlyZpLYOBz7sJtpA0iFGzFykTNJzsk%2B1goU4quBhNZ6)</li>
<li><a href="https://www.blazemeter.com/blog/jmeters-redis-data-set-an-introduction" target="_blank" rel="external">JMeter’s Redis Data Set - An Introduction</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247486811&amp;idx=1&amp;sn=5f8dda70bb78f310342d38ae5921fbf8&amp;chksm=96c9bb3ba1be322d22f9e56fdb71e3946c12073037e616b2ca7f840e3aac44e42182a9352ba2&amp;scene=0&amp;key=bf02c64de891700b6aea54c5ff6bb16973e7b66a559d34a20f16202c9cf917f3d6def615c536f4020aa93509a027af8ec36fa34eb3d67073a3934e7beab929559b2d94466fe866c55dcd0df0becbfe07&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 如何分布式，来看京东金融的设计与实践</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=a4Xw7qDUjL%2BZDzskSoH9RR5JYxe8OLZCoGZUMzGNFNHNqwkw2Aw%2BOF%2B2MOfuqtgK)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=2652402656&amp;idx=1&amp;sn=27fcf31cada1a477c8f119863abc7c22&amp;chksm=8bd8f506bcaf7c10ffa538ea1551cedefd2daf556624376aec7e9d97c3f4e94440d41a678eac&amp;mpshare=1&amp;scene=1&amp;srcid=1014UUDYbpMfN1CkkotvfRho&amp;key=60939f38b0632416606ec289c74c4381c49394c5eeb2029f6a9ce5d75b3bd23f16b6aec11ca5d0e4661133a59693ca6f8b3039721997b52a814b688de2bd98b8ccd5846f458ae298e80b8f9291f4da5c&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">Redis 新数据结构 - Streams</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=sTRZxoNbjps9Ydl2gVWHrzdNj%2B9kVDJ9H5kzqnBGlMhdUNlZundPWwa0XMi685bB)</li>
<li><a href="https://tech.youzan.com/redisji-qun-shi-xian-yuan-li-tan-tao/?sf=wx_sm" target="_blank" rel="external">Redis集群实现原理探讨</a></li>
<li><a href="http://weakyon.com/2017/10/11/sentinel-does-not-trigger-failover-when-master-reboot-resulting-in-data-loss.html" target="_blank" rel="external">当主重启时sentinel没有切换导致数据丢失</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI3NTM1MjExMg==&amp;mid=2247484638&amp;idx=1&amp;sn=b4076f8ceff2eb7a4c1c7b5538376f6c&amp;chksm=eb075b81dc70d297864ef4d131cb4373632e012fa472b0e99af8b26140f7e637657e5baa9406&amp;mpshare=1&amp;scene=1&amp;srcid=1030hKfNQt89lagUGbWbOLWB&amp;key=ffb08cd12e7af3b403842b936d8306fa9dc32475787ad08ac2a021ff6b16a0246c8331ea67dc25af5c97855ebdbe1a6eaa79c35874f0a4967b2705776f85745ad692fafad83de558b9c7db789bd203e7&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">大规模codis集群的治理与实践</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=sTRZxoNbjps9Ydl2gVWHrzdNj%2B9kVDJ9H5kzqnBGlMhdUNlZundPWwa0XMi685bB)</li>
<li><a href="http://www.jianshu.com/p/b5a96142fdd9" target="_blank" rel="external">springboot中redis的使用和分布式session共享问题</a></li>
<li><a href="http://www.baeldung.com/redis-redisson" target="_blank" rel="external">A Guide to Redis with Redisson</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650763383&amp;idx=1&amp;sn=348a84605a7cdefe4e075c9f0310f257&amp;chksm=f3f9c5e2c48e4cf41bd3f708bce3f9a1302a699cf7defe611e9aea120fcb424944119e079362&amp;mpshare=1&amp;scene=1&amp;srcid=0926zoiYASskdGnGTathAoZ0&amp;key=81c0e1f7847266b34a9b6e582d330887aa326b3de5b95757dd22afed130fe616bc41c88ad69b3072a92ab2ecc5b04590f2cd7c9e17f2ebeff7e336b1f84fa429d7429ab29208bca7b55dfb7051b16124&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.12.5+build(16F73" target="_blank" rel="external">直击Redis持久化磁盘IO痛点，让存储不再有负担！</a>&amp;version=12020710&amp;nettype=WIFI&amp;fontScale=100&amp;pass_ticket=IZjSWmUwPVxrb0RtShH0DIYneTbw4mpwFsTvQHESY8xl4BzeZr9LG3wTP8B2YbBl)</li>
<li><a href="http://www.10tiao.com/html/496/201708/2652402631/1.html" target="_blank" rel="external">Redis Cluster 迁移案例</a></li>
<li><a href="https://yemengying.com/2017/06/04/reddit-view-counting/" target="_blank" rel="external">【译】Reddit如何统计每个帖子的浏览量</a></li>
<li><a href="http://liu-xin.me/2015/11/17/在Redis中进行分页排序查询/" target="_blank" rel="external">在Redis中进行分页排序查询</a></li>
<li><a href="http://dbaplus.cn/news-21-1142-1.html" target="_blank" rel="external">一个小改进，解决Redis数据在线加载大痛点</a></li>
<li><a href="https://quericy.me/blog/861/" target="_blank" rel="external">社区好友动态Feed流的Redis实现</a></li>
<li><a href="http://yogoup.sinaapp.com/" target="_blank" rel="external">Redis 应用案例 - 在问题中不断成长</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzAxMzc4Mzk1Mw==&amp;mid=2649836814&amp;idx=6&amp;sn=cdf46386187d9e62d0adae5080dbec32&amp;chksm=8398abf0b4ef22e6c73bed1d0c9f5a2a1ce7284f03f53e34c987b4a8b4c820ce7c3365230960&amp;mpshare=1&amp;scene=1&amp;srcid=0201W1e9y7hKwl9R03DwCDjs&amp;key=afc264f9418f0a9407f65329bec65aaae06477920e04ef5e4a5bdab7b39d8f4768f1399f364880c822c023ba6f5f28e8242292d2fd4bd3b976dd74fc51144f5b2f326e282d045e7646c8a92dc489ebda&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">国内外三个领域巨头告诉你Redis怎么用</a>&amp;version=11020201&amp;pass_ticket=DPEpDdiwlvmnNCQosWeoMLFj00%2B5WgWZy07ni0NWRDM4VW53ttzKH5HcRp3LvhIu)</li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI1MzAzOTY3MA==&amp;mid=2651181087&amp;idx=1&amp;sn=f16a14159509bdcd95f0ea7e886efb47&amp;chksm=f22bf546c55c7c501313480b381398f5934e6c85003af3cf0ec55c83237aac331fe0e58171d0&amp;mpshare=1&amp;scene=1&amp;srcid=1206IWgbtQ3ObVVPCnH6iDDZ&amp;pass_ticket=rYGitFBtuXK2wcyGJQs%2BClGdv6r7mvJIbYXPs4%2FQIg9I63l6bxZnBD4%2BT0%2BMGqM1#rd" target="_blank" rel="external">Redis作为LRU Cache的实现</a></li>
<li><a href="https://zzyongx.github.io/blogs/index.html" target="_blank" rel="external">如何使用redis存储海量小数据</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzQ2NTY0OA==&amp;mid=2650796345&amp;idx=1&amp;sn=d57fc5b626f14ef8eb4630d8efca50cc&amp;chksm=88562c66bf21a570b4c365f62babfb8bb8bdcf5418151d78faeb577dd9c445cd59a70b956c8b&amp;mpshare=1&amp;scene=1&amp;srcid=1223KC0pQbSN0rqCTAthxfqD&amp;key=564c3e9811aee0abd74c6b41213f2a33cce39ed20703417be2edd62a951537154a70e48cb0e338f7b925faa97d7c9b91515105de411dd98782b750d000be219c60f0926688c263a320eca5260958a5c2&amp;ascene=0&amp;uin=MzM4Njg2NDU1&amp;devicetype=iMac+MacBookPro12%2C1+OSX+OSX+10.10.3+build(14D136" target="_blank" rel="external">Redis性能问题排查解决手册</a>&amp;version=11020201&amp;pass_ticket=WpW95huwolsbC3H%2BbMB9JBiKCmqSujwNFO1cf%2FeJ7qsI0svF4rR5oBn6wjmUdwsX)</li>
<li><a href="https://www.tuicool.com/articles/jyINfin" target="_blank" rel="external">如何在Redis中实现事务</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIyMDA1MzgyNw==&amp;mid=2651968211&amp;idx=1&amp;sn=6ffddaf300a2effa53caae421ac9bf81&amp;mpshare=1&amp;scene=1&amp;srcid=0927epWUDcLtZyKdoMdzSM2r&amp;key=c3acc508db720376fc46012061b159aca31b695e132ba992b018535ff32b7a9783d3d273a0a98b02b82cff6ed6e9f4df&amp;ascene=0&amp;uin=MzM4Njg2NDU1" target="_blank" rel="external">ansible-playbook配置redis的sentinel高可用集群</a></li>
<li><a href="http://bg2bkk.github.io/post/redis过期清除机制及应用方法/" target="_blank" rel="external">redis过期清除机制及应用方法</a></li>
<li><a href="https://ruby-china.org/topics/30720" target="_blank" rel="external">记一次 Redis 实战，实现答题系统</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI3NTM1MjExMg==&amp;mid=2247483816&amp;idx=1&amp;sn=136d3da5f2a7cf546440fa8279cbaa47&amp;scene=1&amp;srcid=0823pmID5jdOnO0qQSz1g1ez#rd" target="_blank" rel="external">大规模排行榜系统实践及挑战</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwODA4NjMwNA==&amp;mid=2652897841&amp;idx=1&amp;sn=6328c5011e6c66d9a10d714a9bda52d1&amp;scene=1&amp;srcid=0722ccc3LqYP5NnTChkybEBK&amp;key=77421cf58af4a653bbde6982be263b0a27a67e7340b54addaca64e61167575f415556c668e81a458634cc534efb6b8ea&amp;ascene=0&amp;uin=MzM4Njg2NDU1" target="_blank" rel="external">京东抢购服务高并发实践</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzQ2NTY0OA==&amp;mid=2650796336&amp;idx=1&amp;sn=7ecd39f47fe5a35cbb922fe823640aae&amp;chksm=88562c6fbf21a5798b16d43f726a2394cdd12e042c4357cd584fd83e3e6e13eec10b30f5d566&amp;mpshare=1&amp;scene=1&amp;srcid=1001D0L643UNm9TuvDG0NSMt&amp;pass_ticket=QRj3c3fe9lSk8WVW1On7YHi3%2B9PZ6fwFH7Vlvy%2FuyvNb9hXeJphbWSDHyNsLth1T#rd" target="_blank" rel="external">教你看懂redis配置系列</a></li>
<li><a href="https://leibnizhu.gitlab.io/2016/09/11/Netty+Redis开发高并发应用的一些思考(二" target="_blank" rel="external">Netty+Redis开发高并发应用的一些思考(二)</a>/)</li>
<li><a href="http://sanyuesha.com/2016/08/20/distributed-lock-with-redis/" target="_blank" rel="external">如何用 redis 造一把分布式锁</a></li>
<li><a href="https://www.qcloud.com/community/article/222" target="_blank" rel="external">Redis 设计思路学习与总结</a></li>
</ul>
<p>参考在此：<br><a href="http://moelove.info/redis-articles/" target="_blank" rel="external">Redis技术交流群</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;redis原理与实战，不定期更新&lt;/strong&gt;&lt;br&gt;Redis是业界普遍应用的缓存组件，研究一个组件框架，就要探究它的设计哲学。&lt;br&gt;&lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io/&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="redis" scheme="https://itjinkui.github.io/categories/redis/"/>
    
    
      <category term="redis" scheme="https://itjinkui.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>jvm调优</title>
    <link href="https://itjinkui.github.io/2017/11/17/jvm-tool/"/>
    <id>https://itjinkui.github.io/2017/11/17/jvm-tool/</id>
    <published>2017-11-17T06:52:55.000Z</published>
    <updated>2017-11-17T08:51:09.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jvm调优工具"><a href="#jvm调优工具" class="headerlink" title="jvm调优工具"></a>jvm调优工具</h1><h2 id="jdk的命令行工具"><a href="#jdk的命令行工具" class="headerlink" title="jdk的命令行工具"></a>jdk的命令行工具</h2><ol>
<li><p>jps：虚拟机进程状况工具（jps -l）</p>
</li>
<li><p>jstat：虚拟机统计信息监视工具（jstat -gcutil VMID，stat -gccapacity VMID）  （Local Virtual Machine Identifier,LVMID）  </p>
</li>
<li><p>jinfo：Java配置信息工具</p>
<ul>
<li>jinfo -flag +PrintGCDetails VMID</li>
<li>jinfo -flag +PrintGC VMID</li>
<li>jinfo -flag +PrintGCTimeStamps VMID<br>以上就可以在一个正在运行的JVM中动态开启GC日志功能。</li>
</ul>
</li>
<li><p>jmap：Java内存映像工具</p>
<ul>
<li>jmap -heap VMID 显示Java堆详细信息，例如使用哪种回收器、参数配置、分代状况等。</li>
</ul>
</li>
<li><p>jhat：虚拟机堆转储快照分析工具</p>
</li>
<li><p>jstack：Java堆栈跟踪工具</p>
<ul>
<li>jstack -l VMID</li>
</ul>
</li>
</ol>
<a id="more"></a>
<h2 id="jdk的可视化工具"><a href="#jdk的可视化工具" class="headerlink" title="jdk的可视化工具"></a>jdk的可视化工具</h2><h3 id="jconsole"><a href="#jconsole" class="headerlink" title="jconsole"></a>jconsole</h3><p>JDK中自带的java监控和管理控制台，用于对JVM中内存，线程和类等的监控，是一个基于JMX（java management extensions）的GUI性能监测工具。<br><img src="Java监视和管理控制台-启动.png" alt="Java监视和管理控制台-启动"><br><img src="Java监视和管理控制台.png" alt="内存"></p>
<h3 id="VisualVM"><a href="#VisualVM" class="headerlink" title="VisualVM"></a>VisualVM</h3><p>VisualVM（All-in-One Java Troubleshooting Tool）强大的运行监视和故障处理程序，也能够进行性能分析，CPU、内存，在Profiler页签中能看到。<br>1.插件安装<br><img src="VisualVM插件1.png" alt="VisualVM插件1"><br><img src="VisualVM插件2.png" alt="VisualVM插件2"><br><img src="VisualVM插件3.png" alt="VisualVM插件3"></p>
<p>2.主界面<br><img src="VisualVM概述.png" alt="VisualVM概述"><br><img src="VisualVM监视.png" alt="VisualVM监视"></p>
<p>因为VisualVM的插件太多，重点展示下Visual GC：<br><img src="VisualVM-Visual GC.png" alt="VisualVM-Visual GC"></p>
<h2 id="第三方调优工具"><a href="#第三方调优工具" class="headerlink" title="第三方调优工具"></a>第三方调优工具</h2><blockquote>
<ul>
<li>MAT(Memory Analyzer Tool)</li>
<li><a href="http://gceasy.io" target="_blank" rel="external">GC Easy</a></li>
</ul>
</blockquote>
<p>MAT以eclipse插件形式安装,利用visualvm或者是 jmap命令生产堆文件，导入eclipse mat中生成分析报告：</p>
<p><img src="Memory Analyzer.png" alt="Memory Analyzer Tool"><br><img src="Memory Analyzer-Overview.png" alt="Memory Analyzer-Overview"><br><img src="Top Consumers.png" alt="Top Consumers"></p>
<p>参考在此：<br>深入理解Java虚拟机 第2版<br><a href="http://www.ityouknow.com/java/2017/02/22/jvm-tool.html" target="_blank" rel="external">jvm调优-工具篇</a> 作者：纯洁的微笑</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;jvm调优工具&quot;&gt;&lt;a href=&quot;#jvm调优工具&quot; class=&quot;headerlink&quot; title=&quot;jvm调优工具&quot;&gt;&lt;/a&gt;jvm调优工具&lt;/h1&gt;&lt;h2 id=&quot;jdk的命令行工具&quot;&gt;&lt;a href=&quot;#jdk的命令行工具&quot; class=&quot;headerlink&quot; title=&quot;jdk的命令行工具&quot;&gt;&lt;/a&gt;jdk的命令行工具&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;jps：虚拟机进程状况工具（jps -l）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jstat：虚拟机统计信息监视工具（jstat -gcutil VMID，stat -gccapacity VMID）  （Local Virtual Machine Identifier,LVMID）  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jinfo：Java配置信息工具&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jinfo -flag +PrintGCDetails VMID&lt;/li&gt;
&lt;li&gt;jinfo -flag +PrintGC VMID&lt;/li&gt;
&lt;li&gt;jinfo -flag +PrintGCTimeStamps VMID&lt;br&gt;以上就可以在一个正在运行的JVM中动态开启GC日志功能。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jmap：Java内存映像工具&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jmap -heap VMID 显示Java堆详细信息，例如使用哪种回收器、参数配置、分代状况等。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jhat：虚拟机堆转储快照分析工具&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jstack：Java堆栈跟踪工具&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;jstack -l VMID&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="jvm" scheme="https://itjinkui.github.io/categories/jvm/"/>
    
    
      <category term="jvm" scheme="https://itjinkui.github.io/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>Java内存模型之happens-before</title>
    <link href="https://itjinkui.github.io/2017/11/03/happens-before/"/>
    <id>https://itjinkui.github.io/2017/11/03/happens-before/</id>
    <published>2017-11-03T05:28:14.000Z</published>
    <updated>2017-11-03T06:53:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java内存模型之happens-before"><a href="#Java内存模型之happens-before" class="headerlink" title="Java内存模型之happens-before"></a>Java内存模型之happens-before</h1><p>从JDK 5 开始，JMM就使用happens-before(先行发生原则)的概念来阐述多线程之间的内存可见性。</p>
<p><strong>在JMM中，如果一个操作执行的结果需要对另一个操作可见，那么这两个操作之间必须存在happens-before关系。</strong></p>
<p>happens-before原则定义如下：</p>
<a id="more"></a>
<p><strong>1. 如果一个操作happens-before另一个操作，那么第一个操作的执行结果将对第二个操作可见，而且第一个操作的执行顺序排在第二个操作之前。</strong><br><strong>2. 两个操作之间存在happens-before关系，并不意味着一定要按照happens-before原则制定的顺序来执行。如果重排序之后的执行结果与按照happens-before关系来执行的结果一致，那么这种重排序并不非法。</strong></p>
<p>下面是Java内存模型下一些“天然的“先行发生关系，可以再编码中直接使用。如果两个操作之间的关系不在此列，并且无法从下列规则推导出来的话，虚拟机可以对它们随意地进行重排序。</p>
<p>（摘自《深入理解Java虚拟机第12章》）：</p>
<ul>
<li>程序次序规则（Program Order Rule）：在一个线程内，按照程序代码顺序，书写在前面的操作先行发生于书写在后面的操作。准确地说，应该是控制流顺序而不是程序代码顺序，因为要考虑分支、循环等结构。</li>
<li>锁定规则（Monitor Lock Rule）：一个unlock操作先行发生与后面同一个锁的lock操作。这里必须强调的是同一个锁，而”后面“是指时间上的先后顺序。</li>
<li>volatile变量规则（Volatile Variable Rule）：这是一条比较重要的规则，它标志着volatile保证了线程可见性。通俗点讲就是如果一个线程先去写一个volatile变量，然后一个线程去读这个变量，那么这个写操作一定是happens-before读操作的。</li>
<li>线程启动规则（Thread Start Rule）：Thread 对象的start()方法先行发生与此线程的每一个动作。</li>
<li>线程终止规则（Thread Termination Rule）：线程中的所有操作都先行发生与对此线程的终止检测，我们可以通过Thread.join()方法结束、Thread.isAlive()的返回值等手段检测到线程已经终止执行。</li>
<li>线程中断原则（Thread Interruption Rule）：对线程interrupt()方法的调用先行发生于被中断线程的代码检测到中断事件的发生，可以通过Thread.interrupted()方法检测到是否有中段发生。</li>
<li>对象终结规则（Finalizer Rule）：一个对象的初始化完成（构造函数执行结束）先行发生与它的finalize()方法的开始。</li>
<li>传递性（Transitivity）：如果操作A先行发生与操作B，操作B先行发生于操作C，那就可以得出操作A先行发生于操作C的结论。</li>
</ul>
<p>上面八条是原生Java满足Happens-before关系的规则，但是我们可以对他们进行推导出其他满足happens-before的规则：</p>
<ol>
<li>将一个元素放入一个线程安全的队列的操作Happens-Before从队列中取出这个元素的操作</li>
<li>将一个元素放入一个线程安全容器的操作Happens-Before从容器中取出这个元素的操作</li>
<li>在CountDownLatch上的倒数操作Happens-Before CountDownLatch#await()操作</li>
<li>释放Semaphore许可的操作Happens-Before获得许可操作</li>
<li>Future表示的任务的所有操作Happens-Before Future#get()操作</li>
<li>向Executor提交一个Runnable或Callable的操作Happens-Before任务开始执行操作</li>
</ol>
<p>参考在此：<br>    深入理解Java虚拟机：JVM高级特性与最佳实践（最新第二版）周志明 著</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Java内存模型之happens-before&quot;&gt;&lt;a href=&quot;#Java内存模型之happens-before&quot; class=&quot;headerlink&quot; title=&quot;Java内存模型之happens-before&quot;&gt;&lt;/a&gt;Java内存模型之happens-before&lt;/h1&gt;&lt;p&gt;从JDK 5 开始，JMM就使用happens-before(先行发生原则)的概念来阐述多线程之间的内存可见性。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在JMM中，如果一个操作执行的结果需要对另一个操作可见，那么这两个操作之间必须存在happens-before关系。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;happens-before原则定义如下：&lt;/p&gt;
    
    </summary>
    
      <category term="Java内存模型" scheme="https://itjinkui.github.io/categories/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"/>
    
    
      <category term="Java" scheme="https://itjinkui.github.io/tags/Java/"/>
    
      <category term="Java内存模型" scheme="https://itjinkui.github.io/tags/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>Java锁的种类</title>
    <link href="https://itjinkui.github.io/2017/11/01/Java-lock/"/>
    <id>https://itjinkui.github.io/2017/11/01/Java-lock/</id>
    <published>2017-11-01T06:49:18.000Z</published>
    <updated>2017-12-13T08:33:29.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Java锁的种类-完整列表"><a href="#Java锁的种类-完整列表" class="headerlink" title="Java锁的种类,完整列表"></a>Java锁的种类,完整列表</h1><p><a href="http://ifeve.com/java_lock_see/" target="_blank" rel="external">http://ifeve.com/java_lock_see/</a></p>
<h2 id="什么是锁"><a href="#什么是锁" class="headerlink" title="什么是锁"></a>什么是锁</h2><h3 id="Java锁与Java内存管理"><a href="#Java锁与Java内存管理" class="headerlink" title="Java锁与Java内存管理"></a>Java锁与Java内存管理</h3><p>先来复习下进程与线程的概念：</p>
<a id="more"></a>
<p>进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动，进程是系统进行资源分配和调度的一个独立单位。</p>
<p>线程是进程的一个实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位。线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源(如程序计数器，一组寄存器和栈)，但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。</p>
<p>概念归类到此结束。</p>
<p>JVM的运行时数据区，一图知晓。<br><img src="JVM运行时数据区.png" alt="JVM运行时数据区"></p>
<p>可知，锁就作用在 线程隔离的数据区，因为线程之间需要同步、共享数据。</p>
<h3 id="Java对象锁"><a href="#Java对象锁" class="headerlink" title="Java对象锁"></a>Java对象锁</h3><p>1.类锁：在代码中的方法上加了static和synchronized的锁，或者synchronized(xxx.class）的代码段<br>2.对象锁：在代码中的方法上加了synchronized的锁，或者synchronized(this）的代码段<br>3.私有锁：在类内部声明一个私有属性如private Object lock，在需要加锁的代码段synchronized(lock）</p>
<h2 id="并发工具类"><a href="#并发工具类" class="headerlink" title="并发工具类"></a>并发工具类</h2><p>CountDownLatch和CyclicBarrier是jdk concurrent包下非常有用的两个并发工具类，它们提供了一种控制并发流程的手段。</p>
<p>CountDownLatch 允许一个或多个线程等待其他线程完成操作。<br>CyclicBarrier 让一组线程到达一个同步点后再一起继续运行，在其中任意一个线程未达到同步点，其他到达的线程均会被阻塞。</p>
<h3 id="Semaphore（信号量）"><a href="#Semaphore（信号量）" class="headerlink" title="Semaphore（信号量）"></a>Semaphore（信号量）</h3><p>信号量(Semaphore)，有时被称为信号灯，是在多线程环境下使用的一种设施, 它负责协调各个线程, 以保证它们能够正确、合理的使用公共资源。</p>
<p>一个计数信号量。从概念上讲，信号量维护了一个许可集。如有必要，在许可可用前会阻塞每一个 acquire()，然后再获取该许可。<br>每个 release() 添加一个许可，从而可能释放一个正在阻塞的获取者。但是，不使用实际的许可对象，Semaphore 只对可用许可的号码进行计数，并采取相应的行动。拿到信号量的线程可以进入代码，否则就等待。通过acquire()和release()获取和释放访问许可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 控制并发线程数</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 *执行任务类，获取信号量</div><div class="line">	 */</div><div class="line">	<span class="class"><span class="keyword">class</span> <span class="title">SemaphoreRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line">		<span class="keyword">private</span> Semaphore semaphore;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">int</span> user;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">SemaphoreRunnable</span><span class="params">(Semaphore semaphore, <span class="keyword">int</span> user)</span> </span>&#123;</div><div class="line">			<span class="keyword">this</span>.semaphore = semaphore;</div><div class="line">			<span class="keyword">this</span>.user = user;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="meta">@Override</span></div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="comment">//获取信号量许可</span></div><div class="line">				semaphore.acquire();</div><div class="line">				System.out.println(<span class="string">"用户【"</span> + user + <span class="string">"】进入窗口，准备买票..."</span>);</div><div class="line">				Thread.sleep((<span class="keyword">long</span>)(Math.random()*<span class="number">10000</span>));</div><div class="line">				System.out.println(<span class="string">"用户【"</span> + user + <span class="string">"】买票完成，即将离开..."</span>);</div><div class="line">				Thread.sleep((<span class="keyword">long</span>)(Math.random()*<span class="number">10000</span>));</div><div class="line">				System.out.println(<span class="string">"用户【"</span> + user + <span class="string">"】离开售票窗口..."</span>);</div><div class="line">				<span class="comment">//释放信号量许可</span></div><div class="line">				semaphore.release();</div><div class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//定义窗口个数</span></div><div class="line">		<span class="keyword">final</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</div><div class="line">		<span class="comment">//线程池</span></div><div class="line">		ExecutorService threadPool = Executors.newCachedThreadPool();</div><div class="line">		</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">			threadPool.execute(<span class="keyword">new</span> SemaphoreRunnable(semaphore,i + <span class="number">1</span>));</div><div class="line">		&#125;</div><div class="line">		threadPool.shutdown();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		SemaphoreDemo semaphoreDemo = <span class="keyword">new</span> SemaphoreDemo();</div><div class="line">		semaphoreDemo.execute();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a>CountDownLatch</h3><p>源码注释：<br>A synchronization aid that allows one or more threads to wait until a set of operations being performed in other threads completes.<br>（一个或者多个线程，等待其他多个线程完成某件事情之后才能执行）</p>
<blockquote>
<ul>
<li>CountDownLatch声明： </li>
<li>CountDownLatch的构造函数接受int型参数作为它的计数器，如果想等待N个点完成，就传入N；</li>
<li>调用CountDownLatch的countDown方法时，N会减1，CountDownLatch的await方法会阻塞主线程直到N减少到0。</li>
</ul>
</blockquote>
<p>网上有个经典例子，在此抄录一下帮助理解记忆。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * F1赛车每次进站后，车队技师都需要在尽可能短的时间内对赛车做三个工作：加注燃油、更换轮胎、更换刹车片。</div><div class="line"> * 当然，这三项工作都是同时进行的。只有当这三项工作完成，赛车才能驶出维修站。</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountdownlatchDemo</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Mechanician</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</div><div class="line">        String work;</div><div class="line">        CountDownLatch cDownLatch ;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Mechanician</span><span class="params">(String work,CountDownLatch cDownLatch)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.work = work;</div><div class="line">            <span class="keyword">this</span>.cDownLatch = cDownLatch;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">int</span> random=<span class="keyword">new</span> Random().nextInt(<span class="number">7</span>);</div><div class="line">                TimeUnit.SECONDS.sleep(random);</div><div class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"--- "</span>+work+<span class="string">" 完成，此组耗时："</span>+random+<span class="string">"秒"</span>);</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;<span class="keyword">finally</span>&#123;</div><div class="line">                <span class="comment">/*当前技师的任务完成,cDownLatch计算器减1</span></div><div class="line">                 *通常countDown放在finally里中使用*/</div><div class="line">                cDownLatch.countDown();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		CountDownLatch cDownLatch=<span class="keyword">new</span> CountDownLatch(<span class="number">3</span>);<span class="comment">//初始计数器值为3，对应3个维修组</span></div><div class="line">		 <span class="comment">/*1、赛车进站*/</span></div><div class="line">        System.out.println(<span class="string">"F1赛车进站，时间："</span>+Calendar.getInstance().get(Calendar.SECOND));</div><div class="line">        </div><div class="line">        List&lt;Mechanician&gt; mechanician_team=<span class="keyword">new</span> ArrayList&lt;Mechanician&gt;();</div><div class="line">        mechanician_team.add(<span class="keyword">new</span> Mechanician(<span class="string">"加注燃油"</span>, cDownLatch));</div><div class="line">        mechanician_team.add(<span class="keyword">new</span> Mechanician(<span class="string">"更换轮胎"</span>, cDownLatch));</div><div class="line">        mechanician_team.add(<span class="keyword">new</span> Mechanician(<span class="string">"更换刹车片"</span>, cDownLatch));</div><div class="line">        <span class="keyword">for</span>(Mechanician mechanician : mechanician_team)&#123;</div><div class="line">            <span class="keyword">new</span> Thread(mechanician).start();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/*3、等待技师完成三项工作。实际就是等待cDownLatch计数器变成0*/</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">			cDownLatch.await();</div><div class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line"></div><div class="line">        <span class="comment">/*4、完成维护，出发*/</span></div><div class="line">        System.out.println(<span class="string">"F1赛车维修完毕，出发！时间："</span>+Calendar.getInstance().get(Calendar.SECOND));</div><div class="line">        </div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Countdownlatch 是一个倒计数器锁。调用CountDownLatch对象的await()方法使线程处于等待状态，调用countDown()方法的线程会将计数器减1，当计数到达0时，所有等待线程（可多个，但通常的应用场景中只有一个等待者）开始继续执行。</p>
<h3 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h3><p>源码注释：<br>A synchronization aid that allows a set of threads to all wait for each other to reach a common barrier point.（多个线程互相等待，直到到达同一个同步点，再继续一起执行）</p>
<blockquote>
<ul>
<li>CyclicBarrier(int parties) 默认构造方法，参数表示拦截的线程数量。</li>
<li>CyclicBarrier(int parties, Runnable barrierAction)<br>由于线程之前的调度是由CPU决定的，所以默认的构造方法无法设置线程执行优先级，CyclicBarrier提供一个更高级的构造函数(int parties, Runnable barrierAction)，用于在线程到达同步点时，优先执行线程barrierAction，这样可以更加方便的处理一些复杂的业务场景。</li>
<li>创建CyclicBarrier后，每个线程调用await方法告诉CyclicBarrier自己已经到达同步点，然后当前线程被阻塞。</li>
</ul>
</blockquote>
<p>参考在此：<a href="http://ifeve.com/under-the-hood-runtime-data-areas-javas-memory-model/" target="_blank" rel="external">JAVA的内存模型及结构</a><br><a href="http://lovestblog.cn/blog/2015/10/21/deadlock/" target="_blank" rel="external">消失的死锁</a> 作者：你假笨@JVM<br><a href="http://blog.csdn.net/u013142781/article/details/50830754" target="_blank" rel="external">Java内存管理</a><br><a href="http://cmsblogs.com/?p=2253" target="_blank" rel="external">J.U.C之并发工具类：CountDownLatch</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Java锁的种类-完整列表&quot;&gt;&lt;a href=&quot;#Java锁的种类-完整列表&quot; class=&quot;headerlink&quot; title=&quot;Java锁的种类,完整列表&quot;&gt;&lt;/a&gt;Java锁的种类,完整列表&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://ifeve.com/java_lock_see/&quot;&gt;http://ifeve.com/java_lock_see/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;什么是锁&quot;&gt;&lt;a href=&quot;#什么是锁&quot; class=&quot;headerlink&quot; title=&quot;什么是锁&quot;&gt;&lt;/a&gt;什么是锁&lt;/h2&gt;&lt;h3 id=&quot;Java锁与Java内存管理&quot;&gt;&lt;a href=&quot;#Java锁与Java内存管理&quot; class=&quot;headerlink&quot; title=&quot;Java锁与Java内存管理&quot;&gt;&lt;/a&gt;Java锁与Java内存管理&lt;/h3&gt;&lt;p&gt;先来复习下进程与线程的概念：&lt;/p&gt;
    
    </summary>
    
      <category term="J.U.C" scheme="https://itjinkui.github.io/categories/J-U-C/"/>
    
    
      <category term="Java" scheme="https://itjinkui.github.io/tags/Java/"/>
    
      <category term="J.U.C" scheme="https://itjinkui.github.io/tags/J-U-C/"/>
    
  </entry>
  
  <entry>
    <title>poi实现Excel文件导入、导出</title>
    <link href="https://itjinkui.github.io/2017/10/23/Excel-poi-how/"/>
    <id>https://itjinkui.github.io/2017/10/23/Excel-poi-how/</id>
    <published>2017-10-23T02:33:07.000Z</published>
    <updated>2017-12-13T06:34:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="poi-是什么呢"><a href="#poi-是什么呢" class="headerlink" title="poi 是什么呢"></a>poi 是什么呢</h1><p>Apache POI 简介是用Java编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对Microsoft Office（Excel、WORD、PowerPoint、Visio等）格式档案读和写的功能。POI为“Poor Obfuscation Implementation”的首字母缩写，意为“可怜的模糊实现”。</p>
<a id="more"></a>
<h1 id="与我而言"><a href="#与我而言" class="headerlink" title="与我而言"></a>与我而言</h1><p>使用于某项技术，来完成特定业务是最重要的。看下图最终要实现的功能：<br>考查、考试，在对应的中期（期中）考核形式、期末考试形式 相应位置处画 √<br>必修课补考形式 唯一必填。<br>难点在于 期中考试形式、期末考试形式、必修课补考形式（考试形式字典）是动态可增减的。</p>
<p><img src="excel-poi.png" alt="考务：考试形式登记"></p>
<h2 id="归纳总结Excel工具类"><a href="#归纳总结Excel工具类" class="headerlink" title="归纳总结Excel工具类"></a>归纳总结Excel工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt;  <span class="title">getExcelHeaderString</span><span class="params">(String filePath)</span> </span>&#123;</div><div class="line"><span class="comment">//		You'd use HSSF if you needed to read or write an Excel file using Java (XLS). </span></div><div class="line"><span class="comment">//		You'd use XSSF if you need to read or write an OOXML Excel file using Java (XLSX). 		</span></div><div class="line">		<span class="keyword">boolean</span> isE2007 = <span class="keyword">false</span>;	<span class="comment">//判断是否是excel2007格式</span></div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(filePath.endsWith(<span class="string">"xlsx"</span>)) isE2007 = <span class="keyword">true</span>;</div><div class="line">		<span class="comment">//得到表头字段</span></div><div class="line">        Map&lt;String, String&gt; excelHeaderMap = <span class="keyword">new</span> LinkedHashMap&lt;String, String&gt;();</div><div class="line">		InputStream input = <span class="keyword">null</span>;</div><div class="line">		Workbook wb = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//建立输入流</span></div><div class="line">			input = <span class="keyword">new</span> FileInputStream(filePath);</div><div class="line">			<span class="comment">//根据文件格式(2003或者2007)来初始化</span></div><div class="line">			<span class="keyword">if</span>(isE2007) wb = <span class="keyword">new</span> XSSFWorkbook(input);</div><div class="line">			<span class="keyword">else</span> wb = <span class="keyword">new</span> HSSFWorkbook(input);</div><div class="line">			</div><div class="line">			Sheet sheet = wb.getSheetAt(<span class="number">0</span>);	 <span class="comment">//获得第一个表单</span></div><div class="line">	        Row row = sheet.getRow(<span class="number">0</span>);</div><div class="line">	        <span class="keyword">int</span> columnNum = row.getLastCellNum();</div><div class="line">	     </div><div class="line">	        <span class="keyword">for</span> (<span class="keyword">short</span> i = <span class="number">0</span>; i &lt; columnNum; i++) &#123;</div><div class="line">				Cell cell = row.getCell(i);</div><div class="line">	            String HeaderString = cell.getRichStringCellValue().getString().trim();</div><div class="line">	            excelHeaderMap.put(HeaderString,HeaderString);</div><div class="line">	        &#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;<span class="keyword">finally</span>&#123;</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="keyword">if</span>(<span class="keyword">null</span> != wb)&#123;</div><div class="line">					input.close();</div><div class="line">					wb.close();</div><div class="line">				&#125;</div><div class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> excelHeaderMap;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String,Object&gt;&gt; getBeanList(String filePath) <span class="keyword">throws</span> IOException&#123;</div><div class="line">		<span class="keyword">return</span> getBeanList(filePath, <span class="keyword">null</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 解析excel 数据，每一行存为一个map， key为每列首行对应的文字</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String,Object&gt;&gt; getBeanList(String filePath, Map&lt;String, String&gt; matchingResultMap) <span class="keyword">throws</span> IOException&#123;</div><div class="line">		List&lt;Map&lt;String,Object&gt;&gt; beanList = <span class="keyword">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();</div><div class="line">		</div><div class="line">		<span class="keyword">boolean</span> isE2007 = <span class="keyword">false</span>;	<span class="comment">//判断是否是excel2007格式</span></div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(filePath.endsWith(<span class="string">"xlsx"</span>)) isE2007 = <span class="keyword">true</span>;</div><div class="line">		InputStream input = <span class="keyword">null</span>;</div><div class="line">		Workbook wb = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//建立输入流</span></div><div class="line">			input = <span class="keyword">new</span> FileInputStream(filePath);</div><div class="line">			<span class="comment">//根据文件格式(2003或者2007)来初始化</span></div><div class="line">			<span class="keyword">if</span>(isE2007) wb = <span class="keyword">new</span> XSSFWorkbook(input);</div><div class="line">			<span class="keyword">else</span> wb = <span class="keyword">new</span> HSSFWorkbook(input);</div><div class="line">			</div><div class="line">			Sheet sheet = wb.getSheetAt(<span class="number">0</span>);</div><div class="line">			Map&lt;Short, String&gt; excelHeaderMap = <span class="keyword">new</span> HashMap&lt;Short, String&gt;();</div><div class="line">			<span class="keyword">int</span> firstRowNum = sheet.getFirstRowNum();</div><div class="line">			Row row = sheet.getRow(firstRowNum);</div><div class="line">		    <span class="keyword">int</span> columnNum = row.getLastCellNum();</div><div class="line">		    <span class="keyword">for</span> (<span class="keyword">short</span> i = <span class="number">0</span>; i &lt; columnNum; i++) &#123;</div><div class="line">		    	Cell cell = row.getCell(i);</div><div class="line">		        String HeaderString = cell.getRichStringCellValue().getString().trim();</div><div class="line">		        excelHeaderMap.put(i,HeaderString);</div><div class="line">		    &#125;</div><div class="line">			<span class="keyword">int</span> rowNum = sheet.getPhysicalNumberOfRows();<span class="comment">// 获取第0个sheet的行的数量(1...n)</span></div><div class="line">	</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = firstRowNum+<span class="number">1</span>; i &lt; rowNum; i++) &#123;</div><div class="line">				Row xRow = sheet.getRow(i);</div><div class="line">				Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;();</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">short</span> j=<span class="number">0</span>; j &lt; columnNum; j++ )&#123;</div><div class="line">					String headerKey = <span class="keyword">null</span>;</div><div class="line">					<span class="keyword">if</span> ( matchingResultMap == <span class="keyword">null</span></div><div class="line">							|| matchingResultMap.get(excelHeaderMap.get(j)) == <span class="keyword">null</span>)&#123;</div><div class="line">						headerKey = excelHeaderMap.get(j);</div><div class="line">					&#125; <span class="keyword">else</span> &#123;</div><div class="line">						matchingResultMap.get(excelHeaderMap.get(j));</div><div class="line">					&#125;</div><div class="line">					String headerValue = <span class="keyword">null</span>;</div><div class="line">					<span class="keyword">if</span>(<span class="keyword">null</span> != xRow.getCell(j))&#123;</div><div class="line">						headerValue = getCellContent(xRow.getCell(j)).trim();</div><div class="line">						<span class="keyword">if</span> (beanMap.get(headerKey) == <span class="keyword">null</span>)&#123;</div><div class="line">							beanMap.put(headerKey, headerValue);</div><div class="line">						&#125;</div><div class="line">					&#125;<span class="keyword">else</span>&#123;</div><div class="line">						beanMap.put(headerKey, <span class="string">""</span>);</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(beanMap.containsKey(<span class="keyword">null</span>))&#123;</div><div class="line">					beanMap.remove(<span class="keyword">null</span>);</div><div class="line">				&#125;</div><div class="line">				beanMap.put(<span class="string">"row_num"</span>, i + <span class="number">1</span>);<span class="comment">//excel中的行号</span></div><div class="line">				beanList.add(beanMap);</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">catch</span>(IOException e)&#123;</div><div class="line">			</div><div class="line">		&#125;<span class="keyword">finally</span>&#123;</div><div class="line">			input.close();</div><div class="line">			wb.close();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> beanList;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 根据 二维数组（数据）在指定路径下生成文件</div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@param</span> fileFullPathName 绝对文件路径（包含文件名）</div><div class="line">	 * <span class="doctag">@param</span> fieldNames 表头字段数组</div><div class="line">	 * <span class="doctag">@param</span> data 二维数组（数据）Object[行][列]</div><div class="line">	 * <span class="doctag">@return</span> boolean (标识是否成功生成文件)</div><div class="line">	 * <span class="doctag">@author</span> zhangjinkui</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">writeFile</span><span class="params">(String fileFullPathName,String[] fieldNames,Object[][] data)</span> </span>&#123;</div><div class="line">		</div><div class="line">		<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">		HSSFWorkbook wb = <span class="keyword">new</span> HSSFWorkbook();</div><div class="line">		ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">	    	<span class="comment">// 创建字体</span></div><div class="line">	    	Font font = wb.createFont();</div><div class="line">	    	<span class="comment">// 创建列样式</span></div><div class="line">	    	CellStyle cellStyle = wb.createCellStyle();</div><div class="line">	    	</div><div class="line">	    	Sheet sheet = wb.createSheet();</div><div class="line">			Row row = sheet.createRow(<span class="number">0</span>);</div><div class="line">			<span class="keyword">int</span> colLength = fieldNames.length;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colLength; i++) &#123;</div><div class="line">				row.setHeightInPoints(<span class="number">25</span>);</div><div class="line">				sheet.setColumnWidth(i, <span class="number">256</span>*<span class="number">16</span>);</div><div class="line">				ExcelUtils.createCell(row, i, fieldNames[i],createHeadCell(wb));</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">int</span> line = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span> (line = <span class="number">0</span>; line &lt; data.length; line++) &#123;</div><div class="line">				Row rowtemp = sheet.createRow(line +<span class="number">1</span>);</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; colLength; col++) &#123;</div><div class="line">					createCell2(rowtemp, col,data[line][col],createCellStyle(font,cellStyle));</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			wb.write(baos);</div><div class="line">			File file = <span class="keyword">new</span> File(fileFullPathName);</div><div class="line">            FileUtils.writeByteArrayToFile(file, baos.toByteArray());	</div><div class="line">			flag = <span class="keyword">true</span>;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			flag = <span class="keyword">false</span>;</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					baos.close();</div><div class="line">					wb.close();</div><div class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125; </div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> flag;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 得到字节流之后，可直接写入客户端，也可写入到指定文件</div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@param</span> sheetName sheet页名称</div><div class="line">	 * <span class="doctag">@param</span> fieldNames 表头字段数组</div><div class="line">	 * <span class="doctag">@param</span> data 二维数组（数据）Object[行][列]</div><div class="line">	 * <span class="doctag">@return</span>  返回字节数组</div><div class="line">	 * <span class="doctag">@throws</span> IOException </div><div class="line">	 * <span class="doctag">@author</span> zhangjinkui</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] writeExcel(String sheetName,String[] fieldNames,Object[][] data) <span class="keyword">throws</span> IOException&#123;</div><div class="line">		ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">    	HSSFWorkbook wb = <span class="keyword">new</span> HSSFWorkbook();</div><div class="line">    	<span class="keyword">try</span> &#123;</div><div class="line">	    	<span class="comment">// 创建字体</span></div><div class="line">	    	Font font = wb.createFont();</div><div class="line">	    	<span class="comment">// 创建列样式</span></div><div class="line">	    	CellStyle cellStyle = wb.createCellStyle();</div><div class="line">	    	Sheet sheet = <span class="keyword">null</span>;</div><div class="line">	    	<span class="keyword">if</span>(StringUtils.isBlank(sheetName))&#123;</div><div class="line">	    		sheet = wb.createSheet(<span class="string">""</span>);</div><div class="line">	    	&#125;<span class="keyword">else</span>&#123;</div><div class="line">	    		sheet =  wb.createSheet(sheetName);</div><div class="line">	    	&#125;</div><div class="line">			Row row = sheet.createRow(<span class="number">0</span>);</div><div class="line">			<span class="keyword">int</span> colLength = fieldNames.length;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colLength; i++) &#123;</div><div class="line">				row.setHeightInPoints(<span class="number">25</span>);</div><div class="line">				sheet.setColumnWidth(i, <span class="number">256</span>*<span class="number">16</span>);</div><div class="line">				ExcelUtils.createCell(row, i, fieldNames[i], createHeadCell(wb));</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">int</span> line = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span> (line = <span class="number">0</span>; line &lt; data.length; line++) &#123;</div><div class="line">				Row rowtemp = sheet.createRow(line +<span class="number">1</span>);</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> col = <span class="number">0</span>; col &lt; colLength; col++) &#123;</div><div class="line">					createCell2(rowtemp, col,data[line][col],createCellStyle(font,cellStyle));</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			wb.write(baos);</div><div class="line">    	&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">				<span class="keyword">try</span> &#123;</div><div class="line">					baos.close();</div><div class="line">					wb.close();</div><div class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">					e.printStackTrace();</div><div class="line">				&#125; </div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> baos.toByteArray();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 合并单元格 行</div><div class="line">	 * <span class="doctag">@param</span> sheet	</div><div class="line">	 * <span class="doctag">@param</span> columnNum 从第几列开始（0-based）</div><div class="line">	 * <span class="doctag">@param</span> rowStart		  从第几行开始（0-based）</div><div class="line">	 * <span class="doctag">@param</span> rowspan		  跨多少行</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergedRegionRow</span><span class="params">(Sheet sheet, <span class="keyword">int</span> columnNum, <span class="keyword">int</span> rowStart, <span class="keyword">int</span> rowspan)</span></span>&#123;</div><div class="line">		 sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(</div><div class="line">				 rowStart, <span class="comment">//first row (0-based)</span></div><div class="line">				 rowStart + rowspan-<span class="number">1</span>, <span class="comment">//last row  (0-based)</span></div><div class="line">				 columnNum, <span class="comment">//first column (0-based)</span></div><div class="line">				 columnNum  <span class="comment">//last column  (0-based)</span></div><div class="line">         ));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 合并单元格 列</div><div class="line">	 * <span class="doctag">@param</span> sheet</div><div class="line">	 * <span class="doctag">@param</span> rowNum 第几行 （0-based）</div><div class="line">	 * <span class="doctag">@param</span> colStart	从第几列开始（0-based）</div><div class="line">	 * <span class="doctag">@param</span> colspan	跨多少列</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergedRegionColumn</span><span class="params">(Sheet sheet, <span class="keyword">int</span> rowNum, <span class="keyword">int</span> colStart, <span class="keyword">int</span> colspan)</span></span>&#123;</div><div class="line">		 sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(</div><div class="line">				 rowNum, <span class="comment">//first row (0-based)</span></div><div class="line">				 rowNum, <span class="comment">//last row  (0-based)</span></div><div class="line">				 colStart, <span class="comment">//first column (0-based)</span></div><div class="line">				 colStart + colspan - <span class="number">1</span> <span class="comment">//last column  (0-based)</span></div><div class="line">         ));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 设置生成Cell单元格 </div><div class="line">	 * <span class="doctag">@param</span> row</div><div class="line">	 * <span class="doctag">@param</span> column</div><div class="line">	 * <span class="doctag">@param</span> cellValue</div><div class="line">	 * <span class="doctag">@param</span> cellStyle</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCell</span><span class="params">(Row row, Integer column, String cellValue, CellStyle cellStyle)</span> </span>&#123;</div><div class="line">		Cell cell = row.createCell(column);</div><div class="line">		<span class="keyword">if</span>(StringUtils.isEmpty(cellValue)) cellValue = <span class="string">""</span>;</div><div class="line">		cell.setCellValue(cellValue);</div><div class="line">		<span class="comment">// 统一将单元格格式设置成字符串类型</span></div><div class="line">		cell.setCellType(Cell.CELL_TYPE_STRING);</div><div class="line">		cell.setCellStyle(cellStyle);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCell2</span><span class="params">(Row row, Integer column, Object cellValue, CellStyle cellStyle)</span> </span>&#123;</div><div class="line">		Cell cell = row.createCell(column);</div><div class="line">		<span class="keyword">if</span>(StringUtils.isEmpty(String.valueOf(cellValue))) cellValue = <span class="string">""</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (isNumeric(String.valueOf(cellValue)))&#123;</div><div class="line">				<span class="keyword">double</span> num = Double.valueOf(String.valueOf(cellValue));</div><div class="line">				cell.setCellValue(num);</div><div class="line">				cell.setCellType(Cell.CELL_TYPE_NUMERIC);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				cell.setCellValue(String.valueOf(cellValue));</div><div class="line">				cell.setCellType(Cell.CELL_TYPE_STRING);</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">			cell.setCellValue(String.valueOf(cellValue));</div><div class="line">			cell.setCellType(Cell.CELL_TYPE_STRING);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		cell.setCellStyle(cellStyle);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	 <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNumeric</span><span class="params">(String value)</span></span>&#123;</div><div class="line">		 	<span class="keyword">if</span> (StringUtils.isBlank(value) )&#123;</div><div class="line">		 		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		 	&#125;</div><div class="line">		 	<span class="comment">//http://blog.jobbole.com/96052/ </span></div><div class="line">		 	<span class="comment">//非负浮点数：^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$ </span></div><div class="line"><span class="comment">//	        String reg = "^\\d+(\\.\\d+)?$";</span></div><div class="line">	        String reg = <span class="string">"^(0|([1-9]\\d&#123;0,6&#125;))(\\.\\d+)?$"</span>;<span class="comment">//避免长数字出现科学计数法</span></div><div class="line">	        <span class="keyword">return</span> Pattern.compile(reg).matcher(value).find();</div><div class="line">	    &#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 设置生成Cell单元格 </div><div class="line">	 * <span class="doctag">@param</span> row</div><div class="line">	 * <span class="doctag">@param</span> column</div><div class="line">	 * <span class="doctag">@param</span> cellValue</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCell</span><span class="params">(Row row, Integer column, String cellValue)</span> </span>&#123;</div><div class="line">		Cell cell = row.createCell(column);</div><div class="line">		<span class="keyword">if</span>(StringUtils.isEmpty(cellValue)) cellValue = <span class="string">""</span>;</div><div class="line">		cell.setCellValue(cellValue);</div><div class="line">		<span class="comment">// 统一将单元格格式设置成字符串类型</span></div><div class="line">		cell.setCellType(Cell.CELL_TYPE_STRING);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 设置生成Cell单元格 </div><div class="line">	 * <span class="doctag">@param</span> row</div><div class="line">	 * <span class="doctag">@param</span> column</div><div class="line">	 * <span class="doctag">@param</span> cellValue</div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCell</span><span class="params">(Row row, Integer column, Object cellValue)</span> </span>&#123;</div><div class="line">		Cell cell = row.createCell(column);</div><div class="line">		<span class="keyword">if</span>(StringUtils.isEmpty(String.valueOf(cellValue))) cellValue = <span class="string">""</span>;</div><div class="line">		cell.setCellValue(String.valueOf(cellValue));</div><div class="line">		<span class="comment">// 统一将单元格格式设置成字符串类型</span></div><div class="line">		cell.setCellType(Cell.CELL_TYPE_STRING);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 获得excel列的值，以字符串格式返回</div><div class="line">	 * 避免过大数字 以出现科学计数法形式出现</div><div class="line">	 * <span class="doctag">@param</span> cell</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCellContent</span><span class="params">(Cell cell)</span></span>&#123;</div><div class="line">		<span class="keyword">switch</span> (cell.getCellType()) &#123;</div><div class="line">        <span class="keyword">case</span> Cell.CELL_TYPE_STRING:</div><div class="line">            <span class="keyword">return</span> String.valueOf(cell.getRichStringCellValue().toString().trim());</div><div class="line">        <span class="keyword">case</span> Cell.CELL_TYPE_NUMERIC:</div><div class="line">            <span class="keyword">if</span> (DateUtil.isCellDateFormatted(cell)) &#123;</div><div class="line">            	<span class="keyword">return</span> String.valueOf(cell.getDateCellValue());</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">            	DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">"0"</span>);</div><div class="line">            	<span class="keyword">return</span>  df.format(cell.getNumericCellValue());</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">case</span> Cell.CELL_TYPE_BOOLEAN:</div><div class="line">        	<span class="keyword">return</span> String.valueOf(cell.getBooleanCellValue());</div><div class="line">        <span class="keyword">case</span> Cell.CELL_TYPE_FORMULA:</div><div class="line">        	String strCell = <span class="keyword">null</span>;</div><div class="line">        	<span class="keyword">try</span> &#123;  </div><div class="line">        	       strCell = String.valueOf(cell.getStringCellValue().trim());  </div><div class="line">        	&#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;  </div><div class="line">        	       strCell = String.valueOf(cell.getNumericCellValue());  </div><div class="line">        	&#125;  </div><div class="line">        	<span class="keyword">return</span> strCell;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">        	<span class="keyword">return</span> String.valueOf(cell.getRichStringCellValue().getString().trim());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 正文 默认字体样式，setWrapText=true（自动换行）</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CellStyle <span class="title">createCellStyle</span><span class="params">(Font font,CellStyle cellStyle)</span> </span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">// 设置字体颜色 (黑色)</span></div><div class="line">		font.setColor(HSSFColor.BLACK.index);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		font.setFontName(<span class="string">"宋体"</span>);</div><div class="line">		<span class="comment">// 设置粗体</span></div><div class="line">		font.setBoldweight(HSSFFont.BOLDWEIGHT_NORMAL);</div><div class="line">		<span class="comment">// 设置字体大小</span></div><div class="line">		font.setFontHeightInPoints((<span class="keyword">short</span>)<span class="number">12</span>);</div><div class="line">		cellStyle.setWrapText(<span class="keyword">true</span>);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		cellStyle.setFont(font);</div><div class="line">		<span class="comment">// 设置对齐</span></div><div class="line">		cellStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">		<span class="comment">// 垂直居中</span></div><div class="line">		cellStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">		cellStyle.setLocked(<span class="keyword">false</span>);</div><div class="line">		<span class="keyword">return</span> cellStyle;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 正文 默认字体样式，setWrapText=false（不允许自动换行）</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CellStyle <span class="title">createCellStyleWrapTextFalse</span><span class="params">(Font font,CellStyle cellStyle)</span> </span>&#123;</div><div class="line"></div><div class="line">		<span class="comment">// 设置字体颜色 (黑色)</span></div><div class="line">		font.setColor(HSSFColor.BLACK.index);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		font.setFontName(<span class="string">"宋体"</span>);</div><div class="line">		<span class="comment">// 设置粗体</span></div><div class="line">		font.setBoldweight(HSSFFont.BOLDWEIGHT_NORMAL);</div><div class="line">		<span class="comment">// 设置字体大小</span></div><div class="line">		font.setFontHeightInPoints((<span class="keyword">short</span>)<span class="number">12</span>);</div><div class="line">		cellStyle.setWrapText(<span class="keyword">false</span>);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		cellStyle.setFont(font);</div><div class="line">		<span class="comment">// 设置对齐</span></div><div class="line">		cellStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">		<span class="comment">// 垂直居中</span></div><div class="line">		cellStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">		cellStyle.setLocked(<span class="keyword">false</span>);</div><div class="line">		<span class="keyword">return</span> cellStyle;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 允许换行</div><div class="line">	 * <span class="doctag">@param</span> wb</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CellStyle <span class="title">createBrCellStyle</span><span class="params">(HSSFWorkbook wb)</span> </span>&#123;</div><div class="line">		<span class="comment">// 创建列样式</span></div><div class="line">		CellStyle style = wb.createCellStyle();</div><div class="line">		<span class="comment">// 创建字体</span></div><div class="line">		Font font = wb.createFont();</div><div class="line">		<span class="comment">// 设置字体颜色 (黑色)</span></div><div class="line">		font.setColor(HSSFColor.BLACK.index);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		font.setFontName(<span class="string">"宋体"</span>);</div><div class="line">		<span class="comment">// 设置粗体</span></div><div class="line">		font.setBoldweight(HSSFFont.BOLDWEIGHT_NORMAL);</div><div class="line">		<span class="comment">// 设置字体大小</span></div><div class="line">		font.setFontHeightInPoints((<span class="keyword">short</span>)<span class="number">12</span>);</div><div class="line">		<span class="comment">// 设置不换行</span></div><div class="line">		style.setWrapText(<span class="keyword">true</span>);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		style.setFont(font);</div><div class="line">		<span class="comment">// 设置对齐</span></div><div class="line">		style.setAlignment(CellStyle.ALIGN_LEFT);</div><div class="line">		<span class="comment">// 垂直居中</span></div><div class="line">		style.setVerticalAlignment(CellStyle.ALIGN_LEFT);</div><div class="line">		style.setLocked(<span class="keyword">false</span>);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> style;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 表头默认样式：宋体 12号字体，加粗</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CellStyle <span class="title">createHeadCell</span><span class="params">(HSSFWorkbook wb)</span> </span>&#123;</div><div class="line">		<span class="comment">// 创建字体</span></div><div class="line">    	Font font = wb.createFont();</div><div class="line">    	<span class="comment">// 创建列样式</span></div><div class="line">    	CellStyle cellStyle = wb.createCellStyle();</div><div class="line">		<span class="comment">// 设置字体颜色 (黑色)</span></div><div class="line">		font.setColor(HSSFColor.BLACK.index);</div><div class="line">		font.setFontName(<span class="string">"宋体"</span>);</div><div class="line">		<span class="comment">// 设置粗体</span></div><div class="line">		font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);</div><div class="line">		<span class="comment">// 设置字体大小</span></div><div class="line">		font.setFontHeightInPoints((<span class="keyword">short</span>)<span class="number">12</span>);</div><div class="line">		<span class="comment">// 设置不允许自动换行</span></div><div class="line">		cellStyle.setWrapText(<span class="keyword">false</span>);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		cellStyle.setFont(font);</div><div class="line">		<span class="comment">// 设置对齐</span></div><div class="line">		cellStyle.setAlignment(CellStyle.ALIGN_CENTER);</div><div class="line">		cellStyle.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">		cellStyle.setLocked(<span class="keyword">false</span>);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> cellStyle;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 特殊格式自定义，主要用在表头上</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  CellStyle <span class="title">createHSSFCellStyle</span><span class="params">(HSSFWorkbook wb,<span class="keyword">short</span> boldweight, <span class="keyword">short</span> fontheight, <span class="keyword">short</span> alignment)</span> </span>&#123;</div><div class="line">		<span class="comment">// 创建列样式</span></div><div class="line">		CellStyle style = wb.createCellStyle();</div><div class="line">		<span class="comment">// 创建字体</span></div><div class="line">		Font font = wb.createFont();</div><div class="line">		<span class="comment">// 设置字体颜色 (黑色)</span></div><div class="line">		font.setColor(HSSFColor.BLACK.index);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		font.setFontName(<span class="string">"宋体"</span>);</div><div class="line">		<span class="comment">// 设置粗体</span></div><div class="line">		font.setBoldweight(boldweight);</div><div class="line">		<span class="comment">// 设置字体大小</span></div><div class="line">		font.setFontHeightInPoints(fontheight);</div><div class="line">		<span class="comment">// 设置不换行</span></div><div class="line">		style.setWrapText(<span class="keyword">false</span>);</div><div class="line">		<span class="comment">// 设置字体</span></div><div class="line">		style.setFont(font);</div><div class="line">		<span class="comment">// 设置对齐</span></div><div class="line">		style.setAlignment(alignment);</div><div class="line">		<span class="comment">// 垂直居中</span></div><div class="line">		style.setVerticalAlignment(CellStyle.VERTICAL_CENTER);</div><div class="line">		style.setLocked(<span class="keyword">false</span>);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> style;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 获取合并单元格的值</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMergedRegionValue</span><span class="params">(Sheet sheet, <span class="keyword">int</span> row, <span class="keyword">int</span> column)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sheetMergeCount = sheet.getNumMergedRegions();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sheetMergeCount; i++) &#123;</div><div class="line">            CellRangeAddress ca = sheet.getMergedRegion(i);</div><div class="line">            <span class="keyword">int</span> firstColumn = ca.getFirstColumn();</div><div class="line">            <span class="keyword">int</span> lastColumn = ca.getLastColumn();</div><div class="line">            <span class="keyword">int</span> firstRow = ca.getFirstRow();</div><div class="line">            <span class="keyword">int</span> lastRow = ca.getLastRow();</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (row &gt;= firstRow &amp;&amp; row &lt;= lastRow) &#123;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (column &gt;= firstColumn &amp;&amp; column &lt;= lastColumn) &#123;</div><div class="line">                    Row fRow = sheet.getRow(firstRow);</div><div class="line">                    Cell fCell = fRow.getCell(firstColumn);</div><div class="line">                    <span class="keyword">return</span> ExcelUtils.getCellContent(fCell);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 得到合并区域</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> sheet</div><div class="line">     * <span class="doctag">@param</span> row</div><div class="line">     * <span class="doctag">@param</span> column</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CellRangeAddress <span class="title">getMergedRegion</span><span class="params">(Sheet sheet, <span class="keyword">int</span> row, <span class="keyword">int</span> column)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sheetMergeCount = sheet.getNumMergedRegions();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sheetMergeCount; i++) &#123;</div><div class="line">            CellRangeAddress region = sheet.getMergedRegion(i);</div><div class="line">            <span class="keyword">int</span> firstColumn = region.getFirstColumn();</div><div class="line">            <span class="keyword">int</span> lastColumn = region.getLastColumn();</div><div class="line">            <span class="keyword">int</span> firstRow = region.getFirstRow();</div><div class="line">            <span class="keyword">int</span> lastRow = region.getLastRow();</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (row &gt;= firstRow &amp;&amp; row &lt;= lastRow) &#123;</div><div class="line">                <span class="keyword">if</span> (column &gt;= firstColumn &amp;&amp; column &lt;= lastColumn) &#123;</div><div class="line">                    <span class="keyword">return</span> region;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">	</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断合并了行</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> sheet</div><div class="line">     * <span class="doctag">@param</span> row</div><div class="line">     * <span class="doctag">@param</span> column</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMergedRow</span><span class="params">(Sheet sheet, <span class="keyword">int</span> row, <span class="keyword">int</span> column)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sheetMergeCount = sheet.getNumMergedRegions();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sheetMergeCount; i++) &#123;</div><div class="line">            CellRangeAddress range = sheet.getMergedRegion(i);</div><div class="line">            <span class="keyword">int</span> firstColumn = range.getFirstColumn();</div><div class="line">            <span class="keyword">int</span> lastColumn = range.getLastColumn();</div><div class="line">            <span class="keyword">int</span> firstRow = range.getFirstRow();</div><div class="line">            <span class="keyword">int</span> lastRow = range.getLastRow();</div><div class="line">            <span class="keyword">if</span> (row == firstRow &amp;&amp; row == lastRow) &#123;</div><div class="line">                <span class="keyword">if</span> (column &gt;= firstColumn &amp;&amp; column &lt;= lastColumn) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断指定的单元格是否是合并单元格</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> sheet</div><div class="line">     *            工作表</div><div class="line">     * <span class="doctag">@param</span> row</div><div class="line">     *            行下标</div><div class="line">     * <span class="doctag">@param</span> column</div><div class="line">     *            列下标</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMergedRegion</span><span class="params">(Sheet sheet, <span class="keyword">int</span> row, <span class="keyword">int</span> column)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> sheetMergeCount = sheet.getNumMergedRegions();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sheetMergeCount; i++) &#123;</div><div class="line">            CellRangeAddress range = sheet.getMergedRegion(i);</div><div class="line">            <span class="keyword">int</span> firstColumn = range.getFirstColumn();</div><div class="line">            <span class="keyword">int</span> lastColumn = range.getLastColumn();</div><div class="line">            <span class="keyword">int</span> firstRow = range.getFirstRow();</div><div class="line">            <span class="keyword">int</span> lastRow = range.getLastRow();</div><div class="line">            <span class="keyword">if</span> (row &gt;= firstRow &amp;&amp; row &lt;= lastRow) &#123;</div><div class="line">                <span class="keyword">if</span> (column &gt;= firstColumn &amp;&amp; column &lt;= lastColumn) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>页面部分分为三步：<br>1、上传文件<br><img src="excel-upload-1.png" alt="导入第一步"><br>2、设置数据更新方式<br><img src="excel-upload-2.png" alt="导入第二步"><br>3、提示（比如说Excel中有重复记录，也需要提示出来，让用户修改后重新导入）<br><img src="excel-upload-3.png" alt="导入第三步"></p>
<p>#结语<br>记录备忘之。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;poi-是什么呢&quot;&gt;&lt;a href=&quot;#poi-是什么呢&quot; class=&quot;headerlink&quot; title=&quot;poi 是什么呢&quot;&gt;&lt;/a&gt;poi 是什么呢&lt;/h1&gt;&lt;p&gt;Apache POI 简介是用Java编写的免费开源的跨平台的 Java API，Apache POI提供API给Java程式对Microsoft Office（Excel、WORD、PowerPoint、Visio等）格式档案读和写的功能。POI为“Poor Obfuscation Implementation”的首字母缩写，意为“可怜的模糊实现”。&lt;/p&gt;
    
    </summary>
    
      <category term="poi" scheme="https://itjinkui.github.io/categories/poi/"/>
    
    
      <category term="Excel" scheme="https://itjinkui.github.io/tags/Excel/"/>
    
      <category term="poi" scheme="https://itjinkui.github.io/tags/poi/"/>
    
  </entry>
  
  <entry>
    <title>itext实现录取通知书、成绩单</title>
    <link href="https://itjinkui.github.io/2017/07/03/itext-how/"/>
    <id>https://itjinkui.github.io/2017/07/03/itext-how/</id>
    <published>2017-07-03T07:21:25.000Z</published>
    <updated>2017-12-13T08:49:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="iText-是什么呢"><a href="#iText-是什么呢" class="headerlink" title="iText 是什么呢"></a>iText 是什么呢</h1><p>iText是一个能够快速产生PDF文件的java类库。iText的java类对于那些要产生包含文本，表格，图形的只读文档是很有用的。</p>
<a id="more"></a>
<p>文档、实例等可以看官网详细查看： <a href="http://developers.itextpdf.com/" target="_blank" rel="external">http://developers.itextpdf.com/</a></p>
<h2 id="itext7-实现某大学录取通知书"><a href="#itext7-实现某大学录取通知书" class="headerlink" title="itext7 实现某大学录取通知书"></a>itext7 实现某大学录取通知书</h2><p>在业务系统中，不可避免的会用到PDF来保存、展现数据。<br>有个需求是这样的，给每个新生发送电子版的录取通知书。由于内容、格式相对固定，可以制定好模板，然后填充 编码、学号、姓名等。<br>如下模板：<br><img src="itext7_1.png" alt="itext7_1"></p>
<p>在maven中引入itext7:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;com.itextpdf&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;itext7-core&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;7.0.3&lt;/version&gt;</div><div class="line">	&lt;type&gt;pom&lt;/type&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>贴下代码如下，只需要根据不同的模板传入相应的数据集合就OK了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">	 * </div><div class="line">	 * <span class="doctag">@param</span> src  模版路径</div><div class="line">	 * <span class="doctag">@param</span> dest 目标路径</div><div class="line">	 * <span class="doctag">@param</span> data 数据集合</div><div class="line">	 * <span class="doctag">@param</span> smartMode 是否为最简模式</div><div class="line">	 * <span class="doctag">@return</span></div><div class="line">	 */</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">createPdf</span><span class="params">(String src, String dest, List&lt;Map&lt;String, Object&gt;&gt; data ,<span class="keyword">boolean</span> smartMode)</span> </span>&#123;</div><div class="line">		<span class="comment">// Smart mode</span></div><div class="line">		<span class="keyword">try</span> ( PdfWriter smartmode = <span class="keyword">new</span> PdfWriter(dest);</div><div class="line">				PdfDocument destPdfDocumentSmartMode = <span class="keyword">new</span> PdfDocument(smartmode.setSmartMode(smartMode))</div><div class="line">		) &#123;</div><div class="line"></div><div class="line">			<span class="keyword">for</span> (Map&lt;String, Object&gt; map : data) &#123;</div><div class="line">				ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</div><div class="line">				PdfDocument sourcePdfDocument = <span class="keyword">new</span> PdfDocument(<span class="keyword">new</span> PdfReader(src), <span class="keyword">new</span> PdfWriter(baos));</div><div class="line"></div><div class="line">				<span class="comment">// Read fields</span></div><div class="line">				PdfAcroForm form = PdfAcroForm.getAcroForm(sourcePdfDocument, <span class="keyword">true</span>);</div><div class="line">				Map&lt;String, PdfFormField&gt; fields = form.getFormFields();</div><div class="line"></div><div class="line">				<span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : map.entrySet()) &#123;</div><div class="line">					fields.get(entry.getKey()).setValue(entry.getValue().toString());</div><div class="line">				&#125;</div><div class="line">				<span class="comment">// Flatten fields</span></div><div class="line">				form.flattenFields();</div><div class="line">				sourcePdfDocument.close();</div><div class="line">				sourcePdfDocument = <span class="keyword">new</span> PdfDocument(<span class="keyword">new</span> PdfReader(<span class="keyword">new</span> ByteArrayInputStream(baos.toByteArray())));</div><div class="line">				sourcePdfDocument.copyPagesTo(<span class="number">1</span>, sourcePdfDocument.getNumberOfPages(), destPdfDocumentSmartMode, <span class="keyword">null</span>);</div><div class="line">				baos.close();</div><div class="line">				sourcePdfDocument.close();</div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e1) &#123;</div><div class="line">			e1.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h2 id="itext、jfreechart生成成绩分析图表，并写入成绩单pdf"><a href="#itext、jfreechart生成成绩分析图表，并写入成绩单pdf" class="headerlink" title="itext、jfreechart生成成绩分析图表，并写入成绩单pdf"></a>itext、jfreechart生成成绩分析图表，并写入成绩单pdf</h2><p>浏览器中展示图表，一般都是用百度的<a href="http://echarts.baidu.com/" target="_blank" rel="external">ECharts</a>来展现。<br>但是后台导出成绩单，必须要绕过浏览器才最方便。<br>在maven中引入itext5、jfreechart、ssj</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;itextpdf&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;5.5.10&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;itext-pdfa&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;5.5.10&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;itext-xtra&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;5.5.10&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line">  &lt;groupId&gt;com.itextpdf.tool&lt;/groupId&gt;</div><div class="line">  &lt;artifactId&gt;xmlworker&lt;/artifactId&gt;</div><div class="line">  &lt;version&gt;5.5.10&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;itext-asian&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;5.2.0&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line"> &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</div><div class="line"> &lt;artifactId&gt;commons-math3&lt;/artifactId&gt;</div><div class="line"> &lt;version&gt;3.0&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">	</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.jfree&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;jfreechart&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;1.0.14&lt;/version&gt;</div><div class="line">    &lt;exclusions&gt;</div><div class="line">    	&lt;exclusion&gt;</div><div class="line">    	   &lt;groupId&gt;com.lowagie&lt;/groupId&gt;</div><div class="line">    	   &lt;artifactId&gt;itext&lt;/artifactId&gt;</div><div class="line">    	&lt;/exclusion&gt;</div><div class="line">    &lt;/exclusions&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line">   </div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;ca.umontreal.iro.simul&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;ssj&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;3.2.1&lt;/version&gt;</div><div class="line">    &lt;exclusions&gt;</div><div class="line">    	&lt;exclusion&gt;</div><div class="line">    	 	&lt;groupId&gt;jfree&lt;/groupId&gt;</div><div class="line">    	 	&lt;artifactId&gt;jfreechart&lt;/artifactId&gt;</div><div class="line">    	&lt;/exclusion&gt;</div><div class="line">    &lt;/exclusions&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>示例如图：<br><img src="itext5_1.png" alt="itext5_1"></p>
<p>中位数、标准差、峰度、偏度等使用 org.apache.commons.math3.analysis.function.*<br>直接函数调用，很方便。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>菜头叔每篇公号文章都有个 <strong>禅定时刻</strong>，很是喜欢。在此有样学样吧。</p>
<p>一个酒鬼的自述<br>“一个人活得拧巴是值得理解的，甚至是值得赞美的，这证明他内心还有冲突，并不甘于和人生妥协。但是，通过酒来发泄显得太过脆弱而虚伪，且对不起那瓶好酒。酒带给人们的应该是被压抑的快乐，而不是被压抑的痛苦。”</p>
<p>不是酒鬼，不咋饮酒，但是挺喜欢这句话。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;iText-是什么呢&quot;&gt;&lt;a href=&quot;#iText-是什么呢&quot; class=&quot;headerlink&quot; title=&quot;iText 是什么呢&quot;&gt;&lt;/a&gt;iText 是什么呢&lt;/h1&gt;&lt;p&gt;iText是一个能够快速产生PDF文件的java类库。iText的java类对于那些要产生包含文本，表格，图形的只读文档是很有用的。&lt;/p&gt;
    
    </summary>
    
      <category term="itext" scheme="https://itjinkui.github.io/categories/itext/"/>
    
      <category term="jfreechart" scheme="https://itjinkui.github.io/categories/itext/jfreechart/"/>
    
    
      <category term="itext" scheme="https://itjinkui.github.io/tags/itext/"/>
    
      <category term="jfreechart" scheme="https://itjinkui.github.io/tags/jfreechart/"/>
    
  </entry>
  
  <entry>
    <title>Mac上使用Homebrew进行MySQL卸载、安装，解决乱码</title>
    <link href="https://itjinkui.github.io/2017/06/22/MySQL-how/"/>
    <id>https://itjinkui.github.io/2017/06/22/MySQL-how/</id>
    <published>2017-06-22T05:17:06.000Z</published>
    <updated>2017-06-30T02:30:39.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Mac上使用Homebrew进行MySQL卸载、安装，解决乱码"><a href="#Mac上使用Homebrew进行MySQL卸载、安装，解决乱码" class="headerlink" title="Mac上使用Homebrew进行MySQL卸载、安装，解决乱码"></a>Mac上使用Homebrew进行MySQL卸载、安装，解决乱码</h1><h2 id="Mac上使用Homebrew进行MySQL卸载"><a href="#Mac上使用Homebrew进行MySQL卸载" class="headerlink" title="Mac上使用Homebrew进行MySQL卸载"></a>Mac上使用Homebrew进行MySQL卸载</h2><p><strong>系统环境</strong></p>
<blockquote>
<p>Mac 10.12<br>Homebrew 1.2.3<br>MySQL 5.6.36_1<br><a id="more"></a><br><strong>homebrew 卸载</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ brew remove mysql@5.6</div><div class="line">$ brew cleanup</div><div class="line">$ launchctl unload -w ~/Library/LaunchAgents/homebrew.mxcl.mysql@5.6.plist</div></pre></td></tr></table></figure>
<p><strong>删除文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo rm <span class="_">-f</span> /etc/my.cnf</div><div class="line">$ sudo rm -rf /usr/<span class="built_in">local</span>/var/mysql</div><div class="line">$ sudo rm ~/Library/LaunchAgents/homebrew.mxcl.mysql@5.6.plist</div></pre></td></tr></table></figure>
<h2 id="Mac上使用Homebrew安装MySQL"><a href="#Mac上使用Homebrew安装MySQL" class="headerlink" title="Mac上使用Homebrew安装MySQL"></a>Mac上使用Homebrew安装MySQL</h2><p>$ brew install mysql@5.6</p>
<h3 id="让-MySQL-开机自行启动"><a href="#让-MySQL-开机自行启动" class="headerlink" title="让 MySQL 开机自行启动"></a>让 MySQL 开机自行启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ ln -sfv /usr/<span class="built_in">local</span>/opt/mysql@5.6/*.plist ~/Library/LaunchAgents</div><div class="line">$ sudo find /usr/<span class="built_in">local</span>/Cellar/mysql@5.6/5.6.36_1/ -name <span class="string">"homebrew.mxcl.mysql@5.6.plist"</span> -exec cp &#123;&#125; ~/Library/LaunchAgents/ \;</div><div class="line">$ launchctl load -w ~/Library/LaunchAgents/homebrew.mxcl.mysql@5.6.plist</div></pre></td></tr></table></figure>
<h3 id="指定MySQL数据存放路径"><a href="#指定MySQL数据存放路径" class="headerlink" title="指定MySQL数据存放路径"></a>指定MySQL数据存放路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ mysql_install_db --verbose --user=`whoami` --basedir=<span class="string">"/usr/local/Cellar/mysql@5.6/5.6.36_1"</span> --datadir=/usr/<span class="built_in">local</span>/var/mysql --tmpdir=/tmp</div><div class="line">$ <span class="built_in">cd</span> . ; /usr/<span class="built_in">local</span>/Cellar/mysql@5.6/5.6.36_1/bin/mysqld_safe &amp;</div></pre></td></tr></table></figure>
<h2 id="配置MySQL"><a href="#配置MySQL" class="headerlink" title="配置MySQL"></a>配置MySQL</h2><h3 id="修改-etc-my-cnf，没有就从MySQL安装目录拷贝一个模板过来。"><a href="#修改-etc-my-cnf，没有就从MySQL安装目录拷贝一个模板过来。" class="headerlink" title="修改 /etc/my.cnf，没有就从MySQL安装目录拷贝一个模板过来。"></a>修改 /etc/my.cnf，没有就从MySQL安装目录拷贝一个模板过来。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"># For advice on how to change settings please see</div><div class="line"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</div><div class="line"></div><div class="line"></div><div class="line">[mysqld]</div><div class="line">port=3306</div><div class="line">datadir=/usr/local/var/mysql</div><div class="line"></div><div class="line"></div><div class="line"># Remove leading # and set to the amount of RAM for the most important data</div><div class="line"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</div><div class="line"># innodb_buffer_pool_size = 128M</div><div class="line"></div><div class="line"># Remove leading # to turn on a very important data integrity option: logging</div><div class="line"># changes to the binary log between backups.</div><div class="line"># log_bin</div><div class="line"></div><div class="line"># These are commonly set, remove the # and set as required.</div><div class="line"># basedir = .....</div><div class="line"># datadir = .....</div><div class="line"># port = .....</div><div class="line"># server_id = .....</div><div class="line"># socket = .....</div><div class="line"></div><div class="line"># Remove leading # to set options mainly useful for reporting servers.</div></pre></td></tr></table></figure>
<h3 id="将mysql加入系统环境变量"><a href="#将mysql加入系统环境变量" class="headerlink" title="将mysql加入系统环境变量"></a>将mysql加入系统环境变量</h3><p>执行vim ~/.bash_profile<br>在该文件中添加如下语句，完成后，按esc，然后输入wq保存。<br>export PATH=/usr/local/opt/mysql@5.6/bin:$PATH<br>最后在命令行输入source ~/.bash_profile</p>
<p>ok ,可以启动MySQL了。<br>$ mysql.server start<br>权限配置参见官网：<br><a href="https://dev.mysql.com/doc/refman/5.7/en/resetting-permissions.html" target="_blank" rel="external">https://dev.mysql.com/doc/refman/5.7/en/resetting-permissions.html</a></p>
<h3 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h3><p>默认是没有密码的，进去mysql后，执行语句：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="built_in">set</span> password <span class="keyword">for</span> <span class="string">'root'</span>@<span class="string">'localhost'</span>=password(<span class="string">'root'</span>);</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure>
<p>接下来使用密码登录MySQL：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ mysql -uroot -p</div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 395</div><div class="line">Server version: 5.6.36 Homebrew</div><div class="line"></div><div class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; show variables like <span class="string">'character%'</span>;</div><div class="line">+--------------------------+------------------------------------------------------------+</div><div class="line">| Variable_name            | Value                                                      |</div><div class="line">+--------------------------+------------------------------------------------------------+</div><div class="line">| character_set_client     | utf8                                                       |</div><div class="line">| character_set_connection | utf8                                                       |</div><div class="line">| character_set_database   | utf8                                                       |</div><div class="line">| character_set_filesystem | binary                                                     |</div><div class="line">| character_set_results    | utf8                                                       |</div><div class="line">| character_set_server     | utf8                                                       |</div><div class="line">| character_set_system     | utf8                                                       |</div><div class="line">| character_sets_dir       | /usr/<span class="built_in">local</span>/Cellar/mysql@5.6/5.6.36_1/share/mysql/charsets/ |</div><div class="line">+--------------------------+------------------------------------------------------------+</div><div class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.04 sec)</div></pre></td></tr></table></figure>
<p>看到utf8，编码就不会出问题了。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>之所以写这篇，原因是从Windows转到Mac环境搞开发，碰到了乱码问题，各种配置都试了也没解决。卸载重装妥妥的。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Mac上使用Homebrew进行MySQL卸载、安装，解决乱码&quot;&gt;&lt;a href=&quot;#Mac上使用Homebrew进行MySQL卸载、安装，解决乱码&quot; class=&quot;headerlink&quot; title=&quot;Mac上使用Homebrew进行MySQL卸载、安装，解决乱码&quot;&gt;&lt;/a&gt;Mac上使用Homebrew进行MySQL卸载、安装，解决乱码&lt;/h1&gt;&lt;h2 id=&quot;Mac上使用Homebrew进行MySQL卸载&quot;&gt;&lt;a href=&quot;#Mac上使用Homebrew进行MySQL卸载&quot; class=&quot;headerlink&quot; title=&quot;Mac上使用Homebrew进行MySQL卸载&quot;&gt;&lt;/a&gt;Mac上使用Homebrew进行MySQL卸载&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;系统环境&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Mac 10.12&lt;br&gt;Homebrew 1.2.3&lt;br&gt;MySQL 5.6.36_1&lt;br&gt;
    
    </summary>
    
      <category term="Homebrew" scheme="https://itjinkui.github.io/categories/Homebrew/"/>
    
      <category term="MySQL" scheme="https://itjinkui.github.io/categories/Homebrew/MySQL/"/>
    
    
      <category term="Homebrew" scheme="https://itjinkui.github.io/tags/Homebrew/"/>
    
      <category term="MySQL" scheme="https://itjinkui.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Docker初探</title>
    <link href="https://itjinkui.github.io/2017/06/16/docker-how-1/"/>
    <id>https://itjinkui.github.io/2017/06/16/docker-how-1/</id>
    <published>2017-06-16T06:04:53.000Z</published>
    <updated>2017-12-13T08:33:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="初始容器与Docker"><a href="#初始容器与Docker" class="headerlink" title="初始容器与Docker"></a>初始容器与Docker</h1><p><a href="https://docs.docker.com/engine/docker-overview/" target="_blank" rel="external">https://docs.docker.com/engine/docker-overview/</a></p>
<h2 id="什么是Docker"><a href="#什么是Docker" class="headerlink" title="什么是Docker"></a>什么是Docker</h2><h3 id="Docker开源项目背景"><a href="#Docker开源项目背景" class="headerlink" title="Docker开源项目背景"></a>Docker开源项目背景</h3><p>Docker是基于Go语言实现的开源容器项目，诞生于2013年年初，最初发起者是dotCloud公司。Docker自开源后受到广泛的关注和讨论，目前已有多个相关项目（包括Docker三剑客、Kubernetes等），逐渐形成了围绕Docker容器的生态体系。<br>由于Docker在业界造成的影响力实在太大，dotCloud公司后来也直接改名为Docker Inc，并专注于Docker相关技术和产品的开发。</p>
<p>对于Docker，目前的定义是一个开源的容器引擎，可以方便地对容器（关于容器，将在第2章详细介绍）进行管理。其对镜像的打包封装，以及引入的Docker Registry对镜像的统一管理，构建了方便快捷的“Build，Ship and Run”流程，它可以统一整个开发、测试和部署的环境和流程，极大地减少运维成本。<br><a id="more"></a></p>
<h3 id="Docker在开发和运维中的优势"><a href="#Docker在开发和运维中的优势" class="headerlink" title="Docker在开发和运维中的优势"></a>Docker在开发和运维中的优势</h3><p>对开发和运维（DevOps）人员来说，可能最梦寐以求的效果就是一次创建或配置，之后可以在任意地方、任意时间让应用正常运行。</p>
<p>1.更快速的交付和部署。使用Docker，开发人员可以使用镜像来快速构建一套标准的开发环境；开发完成之后，测试和运维人员可以直接使用完全相同环境来部署代码。只要开发测试过的代码，就可以确保在生产环境无缝运行。Docker可以快速创建和删除容器，实现快速迭代，大量节约开发、测试、部署的时间。并且，整个过程全程可见，使团队更容易理解应用的创建和工作过程。<br>2.更高效的资源利用。Docker容器的运行不需要额外的虚拟化管理程序（Virtual Machine Manager以及Hypervisor）支持，它是内核级的虚拟化，可以实现更高的性能，同时对资源的额外需求很低。<br>3.更轻松的迁移和扩展。<br>4.更简单的更新管理。使用Dockerfile，只需要小小的配置修改，就可以替代以往大量的更新工作。并且所有修改都以增量的方式被分发和更新，从而实现自动化并且高效的容器管理。</p>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>1.Docker镜像<br>镜像是创建Docker容器的基础。通过版本管理和增量的文件系统，Docker提供了一套十分简单的机制来创建和更新现有的镜像。<br>与容器相对应，如果说容器提供了一个完整的、隔离的运行环境，那么镜像则是这个运行环境的静态体现，是一个还没有运行起来的“运行环境”。<br>Docker镜像通常是通过Dockerfile来创建的，Dockerfile提供了镜像内容的定制，同时也体现了层级关系的建立。</p>
<p>ps:镜像自身是只读的。容器从镜像启动的时候，会在镜像的最上层创建一个可写层。<br>2.Docker容器<br>在功能上，Docker通过Libcontainer实现对容器生命周期的管理、信息的设置和查询，以及监控和通信等功能。而容器也是对镜像的完美诠释，容器以镜像为基础，同时又为镜像提供了一个标准的和隔离的执行环境。<br>在概念上，容器则很好地诠释了Docker集装箱的理念，集装箱可以存放任何货物，可以通过邮轮将货物运输到世界各地。运输集装箱的邮轮和装载卸载集装箱的码头都不用关心集装箱里的货物，这是一种标准的集装和运输方式。类似的，Docker的容器就是“软件界的集装箱”，它可以安装任意的软件和库文件，做任意的运行环境配置。</p>
<p>3.Docker仓库<br>是Docker集中存放镜像文件的场所。</p>
<h2 id="Install-Docker-for-Mac"><a href="#Install-Docker-for-Mac" class="headerlink" title="Install Docker for Mac"></a>Install Docker for Mac</h2><p><a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="external">https://docs.docker.com/docker-for-mac/install/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">~ docker version</div><div class="line">Client:</div><div class="line"> Version:      17.03.1-ce</div><div class="line"> API version:  1.27</div><div class="line"> Go version:   go1.7.5</div><div class="line"> Git commit:   c6d412e</div><div class="line"> Built:        Tue Mar 28 00:40:02 2017</div><div class="line"> OS/Arch:      darwin/amd64</div><div class="line"></div><div class="line">Server:</div><div class="line"> Version:      17.03.1-ce</div><div class="line"> API version:  1.27 (minimum version 1.12)</div><div class="line"> Go version:   go1.7.5</div><div class="line"> Git commit:   c6d412e</div><div class="line"> Built:        Fri Mar 24 00:00:50 2017</div><div class="line"> OS/Arch:      linux/amd64</div><div class="line"> Experimental: <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>我们看到Client和Server均有输出，则说明Docker for Mac已经正常启动。</p>
<h2 id="CentOS环境下安装Docker"><a href="#CentOS环境下安装Docker" class="headerlink" title="CentOS环境下安装Docker"></a>CentOS环境下安装Docker</h2><p>OS requirements<br>To install Docker, you need the 64-bit version of CentOS 7.<br>我是在Mac上安装的VirtualBox，然后装上CentOS 7镜像。</p>
<p>对于CentOS 7系统，CentOS-Extras源中已内置Docker</p>
<h3 id="yum安装"><a href="#yum安装" class="headerlink" title="yum安装"></a>yum安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker yum.repos.d]<span class="comment"># sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-'EOF'</span></div><div class="line">&gt; [dockerrepo]</div><div class="line">&gt; name=Docker Repository</div><div class="line">&gt; baseurl=https://yum.dockerproject.org/repo/main/centos/<span class="variable">$releasever</span>/</div><div class="line">&gt; enabled=1</div><div class="line">&gt; gpgcheck=1</div><div class="line">&gt; gpgkey=https://yum.dockerproject.org/gpg</div><div class="line">&gt; EOF</div></pre></td></tr></table></figure>
<p>之后更新yum软件源缓存，并安装docker-engine 即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo yum install -y yum-utils</div><div class="line">$ sudo yum update</div><div class="line">$ sudo yum makecache fast</div><div class="line">$ sudo yum install docker-engine</div></pre></td></tr></table></figure>
<p>这是最新的版本。要想随意指定要安装的版本，如下命令，官网上如下。<br>1.List the available versions:</p>
<p>$ yum list docker-engine.x86_64  –showduplicates |sort -r</p>
<p>2.Install a specific version by adding the version after docker-engine, separated by a hyphen (-):<br>$ sudo yum install docker-engine-version</p>
<h3 id="脚本安装"><a href="#脚本安装" class="headerlink" title="脚本安装"></a>脚本安装</h3><p>1.更新系统包到最新。<br>$ yum -y update</p>
<p>2.执行Docker安装脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ curl -fsSL https://get.docker.com/ | sh</div></pre></td></tr></table></figure>
<h3 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h3><p>Docker Hub 镜像站点</p>
<p>安装／升级你的Docker客户端<br>您可以通过阿里云的镜像仓库下载：mirrors.aliyun.com/help/docker-engine</p>
<p>或执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl <span class="_">-s</span>SL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</div></pre></td></tr></table></figure>
<p>如何使用Docker加速器<br>针对Docker客户端版本大于1.10的用户</p>
<p>您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器：</p>
<p>sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’<br>{<br>  “registry-mirrors”: [“<a href="https://wgqgbfsb.mirror.aliyuncs.com" target="_blank" rel="external">https://wgqgbfsb.mirror.aliyuncs.com</a>“]<br>}<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker</p>
<p>镜像是运行容器的前提，官方的Docker Hub网站已经提供了数十万个镜像供大家开放下载。<br>可以使用docker pull命令直接从Docker Hub镜像源来下载镜像。该命令的格式为docker pull NAME[：TAG]。其中，NAME是镜像仓库的名称（用来区分镜像），TAG是镜像的标签（往往用来表示版本信息）。通常情况下，描述一个镜像需要包括“名称+标签”信息。</p>
<p>现在想要获得centos的Docker镜像，<br>1.docker search –no-trunc centos<br>2.docker pull  docker.io/jdeathe/centos-ssh</p>
<h3 id="查看镜像信息"><a href="#查看镜像信息" class="headerlink" title="查看镜像信息"></a>查看镜像信息</h3><p>1.使用images命令列出镜像<br>2.使用tag命令添加镜像标签<br>3.使用inspect命令查看详细信息<br>4.使用history命令查看镜像历史(docker history –no-trunc centos-ssh)</p>
<h3 id="搜寻镜像"><a href="#搜寻镜像" class="headerlink" title="搜寻镜像"></a>搜寻镜像</h3><p>使用docker search命令可以搜索远端仓库中共享的镜像，默认搜索官方仓库中的镜像。用法为docker search TERM，支持的参数主要包括：<br>·–automated=true|false：仅显示自动创建的镜像，默认为否；<br>·–no-trunc=true|false：输出信息不截断显示，默认为否；<br>·–filter=stars=X：指定仅显示评价为指定星级以上的镜像，默认为0，即输出所有镜像。<br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ docker search --filter=stars=3 ubuntu</div><div class="line">$ docker search -f stars=25 centos</div></pre></td></tr></table></figure>
<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p>使用标签删除镜像<br>使用docker rmi命令可以删除镜像，命令格式为docker rmi IMAGE[IMAGE…]，其中IMAGE可以为标签或ID。</p>
<h3 id="创建镜像"><a href="#创建镜像" class="headerlink" title="创建镜像"></a>创建镜像</h3><p>创建镜像的方法主要有三种：基于已有镜像的容器创建、基于本地模板导入、基于Dockerfile创建。<br>本节将重点介绍前两种方法。最后一种基于Dockerfile创建的方法将在后续章节专门予以详细介绍。</p>
<h4 id="基于已有镜像的容器创建"><a href="#基于已有镜像的容器创建" class="headerlink" title="基于已有镜像的容器创建"></a>基于已有镜像的容器创建</h4><p>该方法主要是使用docker commit命令。命令格式为docker commit[OPTIONS]CONTAINER[REPOSITORY[：TAG]]，主要选项包括：<br>·-a，–author=””：作者信息；<br>·-c，–change=[]：提交的时候执行Dockerfile指令，包括CMD|ENTRYPOINT|ENV|EXPOSE|LABEL|ONBUILD|USER|VOLUME|WORKDIR等；<br>·-m，–message=””：提交消息；<br>·-p，–pause=true：提交时暂停容器运行。</p>
<h4 id="基于本地模板导入"><a href="#基于本地模板导入" class="headerlink" title="基于本地模板导入"></a>基于本地模板导入</h4><p>要直接导入一个镜像，可以使用OpenVZ提供的模板来创建，或者用其他已导出的镜像模板来创建。OPENVZ模板的下载地址为<a href="http://openvz.org/Download/templates/precreated" target="_blank" rel="external">http://openvz.org/Download/templates/precreated</a></p>
<h4 id="存出和载入镜像"><a href="#存出和载入镜像" class="headerlink" title="存出和载入镜像"></a>存出和载入镜像</h4><p>1.存出镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker save -o centos_7.tar.gz daocloud.io/centos:7</span></div><div class="line">[root@centos-docker docker]<span class="comment"># ls</span></div><div class="line">centos_7.tar.gz  certs.d  daemon.json  key.json</div></pre></td></tr></table></figure></p>
<p>2.载入镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker load --input centos_7.tar.gz</span></div><div class="line">Loaded image: daocloud.io/centos:7</div></pre></td></tr></table></figure>
<p>或者<br>$ docker load &lt; centos_7.tar.gz<br>这将导入镜像及其相关的元数据信息（包括标签等）。</p>
<h3 id="创建-amp-启动一个容器："><a href="#创建-amp-启动一个容器：" class="headerlink" title="创建&amp;启动一个容器："></a>创建&amp;启动一个容器：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ docker run <span class="_">-d</span> -p 10022:22 -v /dfile/:/dfile/ -h <span class="string">"centos-d"</span> --name centos<span class="_">-d</span> centos-ssh /usr/sbin/sshd -D</div><div class="line"></div><div class="line">$ mount -t vboxsf docker_files /docker</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@centos<span class="_">-d</span> /]<span class="comment"># netstat -tunlp</span></div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1/sshd</div><div class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1/sshd</div></pre></td></tr></table></figure>
<p>其中10022是宿主主机的端口，22是容器的SSH服务监听端口：<br>-p 10022:22<br>使用HostPort：ContainerPort格式将本地的10022端口映射到容器的22端口。</p>
<p>在宿主主机或其他主机上，可以通过SSH访问10022端口来登录容器。</p>
<p>使用docker inspect来查看容器的基础信息。<br>参见：<a href="https://docs.docker.com/engine/reference/commandline/inspect/" target="_blank" rel="external">https://docs.docker.com/engine/reference/commandline/inspect/</a></p>
<p>-v /dfile(主机):/dfile(容器):ro<br>上面的命令加载主机的/dfile目录到容器的/dfile目录。<br>ps：本地目录的路径必须是绝对路径，如果目录不存在，Docker会自动创建。</p>
<p>Docker挂载数据卷的默认权限是读写（rw），用户也可以通过ro指定为只读。</p>
<p>mount -t vboxsf the_share_name /a_folder_name<br>ps:VirtualBox与Mac共享文件夹为：docker_files<br><img src="VirtualBoxformac.png" alt="VirtualBoxformac"><br>ps: $ docker ps -a<br>查看容器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker start centos-d</span></div><div class="line">centos<span class="_">-d</span></div><div class="line">[root@centos-docker docker]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID        IMAGE               COMMAND               CREATED             STATUS                   PORTS                   NAMES</div><div class="line">0ffb8ab3f777        centos-ssh          <span class="string">"/usr/sbin/sshd -D"</span>   11 weeks ago        Up 12 seconds            0.0.0.0:10022-&gt;22/tcp   centos<span class="_">-d</span></div></pre></td></tr></table></figure>
<p>$ docker-enter centos-d 进入容器。<br>可以按Ctrl+d或输入exit命令来退出容器，<br>通过exit命令或Ctrl+d来退出终端时，所创建的容器立刻终止，处于stopped状态。</p>
<h4 id="利用ssh进入到docker中的centos里"><a href="#利用ssh进入到docker中的centos里" class="headerlink" title="利用ssh进入到docker中的centos里"></a>利用ssh进入到docker中的centos里</h4><p>然后 我们试着从宿主机直接进入到docker中的centos里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">~ ssh root@192.168.99.100 -p 10022</div><div class="line">root@192.168.99.100<span class="string">'s password:</span></div><div class="line">Last login: Thu Jun 29 09:03:57 2017 from 192.168.99.1</div><div class="line">[root@centos-d ~]#</div></pre></td></tr></table></figure>
<p>避免了先进入虚拟机系统，然后再进入docker中的centos里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~ ssh root@192.168.99.100 -p 22</div><div class="line">root@192.168.99.100<span class="string">'s password:</span></div><div class="line">Last login: Thu Jun 29 17:11:29 2017 from 192.168.99.1</div><div class="line">[root@centos-docker ~]# docker-enter centos-d</div><div class="line">Last login: Thu Jun 29 09:21:21 UTC 2017 from 192.168.99.1 on pts/0</div><div class="line">[root@centos-d ~]#</div></pre></td></tr></table></figure>
<h4 id="create命令与容器运行模式相关的选项"><a href="#create命令与容器运行模式相关的选项" class="headerlink" title="create命令与容器运行模式相关的选项"></a>create命令与容器运行模式相关的选项</h4><p>-d, –detach=true|false (是否在后台运行容器，默认为否)<br>-P, –publish-all=true|false (通过NAT机制将容器标记暴露的端口自动映射到本地主机的临时端口)<br>-p, –publish=[] (指定如何映射到本地主机端口)<br>–rm=true|false （容器退出后是否自动删除，不能跟-d同时使用）<br>-i, –interactive=true|false (保持标准输入打开，默认为false)<br>-t, –tty=true|false (是否分配一个伪终端，默认是false)<br>–expose=[] (指定容器会暴露出来的端口或端口范围)<br>–group-add=[] (运行容器的用户组)<br>-v|–volume[=[[HOST-DIR:]CONTAINER-DIR[:OPTIONS]]] (挂载主机上的文件卷到容器内)<br>-w, –workdir=”” (容器内的默认工作目录)</p>
<h4 id="create命令与容器环境和配置相关的选项"><a href="#create命令与容器环境和配置相关的选项" class="headerlink" title="create命令与容器环境和配置相关的选项"></a>create命令与容器环境和配置相关的选项</h4><p>–add-host=[] (在容器内添加一个主机名到IP地址的映射关系（通过/etc/hosts文件）)<br>-h, –hostname=”” (指定容器内的主机名)<br>–name=”” (指定容器的别名)</p>
<h4 id="create命令与容器资源限制和安全保护相关的选项"><a href="#create命令与容器资源限制和安全保护相关的选项" class="headerlink" title="create命令与容器资源限制和安全保护相关的选项"></a>create命令与容器资源限制和安全保护相关的选项</h4><p>–privileged=true|false (是否给容器以高权限，这意味着容器内应用将不受权限下限制，一般不推荐)<br>–read-only=true|false (是否让容器内的文件系统只读)</p>
<h4 id="启动容器说明"><a href="#启动容器说明" class="headerlink" title="启动容器说明"></a>启动容器说明</h4><p>当利用docker run来创建并启动容器时，Docker在后台运行的标准操作包括：</p>
<p>·检查本地是否存在指定的镜像，不存在就从公有仓库下载；<br>·利用镜像创建一个容器，并启动该容器；<br>·分配一个文件系统给容器，并在只读的镜像层外面挂载一层可读写层；<br>·从宿主主机配置的网桥接口中桥接一个虚拟接口到容器中；<br>·从网桥的地址池配置一个IP地址给容器；<br>·执行用户指定的应用程序；<br>·执行完毕后容器被自动终止。</p>
<h3 id="终止容器"><a href="#终止容器" class="headerlink" title="终止容器"></a>终止容器</h3><p>可以使用docker stop来终止一个运行中的容器。该命令的格式为docker stop[-t|–time[=10]][CONTAINER…]。<br>首先向容器发送SIGTERM信号，等待一段超时时间（默认为10秒）后，再发送SIGKILL信号来终止容器。</p>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><p>在使用-d参数时，容器启动后会进入后台，用户无法看到容器中的信息，也无法进行操作。<br>这个时候如果需要进入容器进行操作，有多种方法，包括使用官方的attach或exec命令，以及第三方的nsenter工具等。下面分别介绍一下。</p>
<h4 id="attach命令"><a href="#attach命令" class="headerlink" title="attach命令"></a>attach命令</h4><p>attach是Docker自带的命令，命令格式为：</p>
<p>支持三个主要选项：<br>·–detach-keys[=[]]：指定退出attach模式的快捷键序列，默认是CTRL-p CTRL-q；<br>·–no-stdin=true|false：是否关闭标准输入，默认是保持打开；<br>·–sig-proxy=true|false：是否代理收到的系统信号给应用进程，默认为true。<br>ps:当多个窗口同时用attach命令连到同一个容器的时候，所有窗口都会同步显示。不常用。</p>
<h4 id="exec命令"><a href="#exec命令" class="headerlink" title="exec命令"></a>exec命令</h4><p>Docker从1.3.0版本起提供了一个更加方便的exec命令，可以在容器内直接执行任意命令。<br>比较重要的参数有：<br>·-i，–interactive=true|false：打开标准输入接受用户输入命令，默认为false；<br>·–privileged=true|false：是否给执行命令以高权限，默认为false；<br>·-t，–tty=true|false：分配伪终端，默认为false；<br>·-u，–user=””：执行命令的用户名或ID。<br>例如进入到刚创建的容器中，并启动一个bash：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker exec -it centos-d /bin/bash</span></div><div class="line">[root@centos<span class="_">-d</span> /]<span class="comment"># pwd</span></div><div class="line">/</div></pre></td></tr></table></figure>
<p>可以看到，一个bash终端打开了，在不影响容器内其他应用的前提下，用户可以很容易与容器进行交互。<br>注意<br>通过指定-it参数来保持标准输入打开，并且分配一个伪终端。通过exec命令对容器执行操作是最为推荐的方式。</p>
<h4 id="nsenter工具"><a href="#nsenter工具" class="headerlink" title="nsenter工具"></a>nsenter工具</h4><p>在util-linux软件包版本2.23+中包含nsenter工具。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker start centos-d</span></div><div class="line">centos<span class="_">-d</span></div><div class="line">[root@centos-docker docker]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID        IMAGE               COMMAND               CREATED             STATUS              PORTS                   NAMES</div><div class="line">0ffb8ab3f777        centos-ssh          <span class="string">"/usr/sbin/sshd -D"</span>   11 weeks ago        Up 6 seconds        0.0.0.0:10022-&gt;22/tcp   centos<span class="_">-d</span></div><div class="line">[root@centos-docker docker]<span class="comment"># PID=$(docker inspect --format "&#123;&#123; .State.Pid &#125;&#125;" centos-d)</span></div><div class="line">[root@centos-docker docker]<span class="comment"># nsenter --target $PID --mount --uts --ipc --net --pid</span></div><div class="line">[root@centos<span class="_">-d</span> /]<span class="comment"># ps -ef</span></div><div class="line">UID        PID  PPID  C STIME TTY          TIME CMD</div><div class="line">root         1     0  0 06:04 ?        00:00:00 /usr/sbin/sshd -D</div><div class="line">root         5     0  0 06:07 ?        00:00:00 -bash</div><div class="line">root        19     5  0 06:09 ?        00:00:00 ps -ef</div></pre></td></tr></table></figure>
<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><p>可以使用docker rm命令来删除处于终止或退出状态的容器，命令格式为docker rm[-f|–force][-l|–link][-v|–volumes]CONTAINER[CONTAINER…]。<br>主要支持的选项包括：<br>·-f，–force=false：是否强行终止并删除一个运行中的容器；<br>·-l，–link=false：删除容器的连接，但保留容器；<br>·-v，–volumes=false：删除容器挂载的数据卷。</p>
<h3 id="导入和导出容器"><a href="#导入和导出容器" class="headerlink" title="导入和导出容器"></a>导入和导出容器</h3><p>某些时候，需要将容器从一个系统迁移到另外一个系统，此时可以使用Docker的导入和导出功能。这也是Docker自身提供的一个重要特性。</p>
<h4 id="导出容器"><a href="#导出容器" class="headerlink" title="导出容器"></a>导出容器</h4><p>导出容器是指导出一个已经创建的容器到一个文件，不管此时这个容器是否处于运行状态，可以使用docker export命令，该命令的格式为docker export[-o|–output[=””]]CONTAINER。其中，可以通过-o选项来指定导出的tar文件名，也可以直接通过重定向来实现。<br>ps:实现容器的迁移</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@centos-docker docker]<span class="comment"># docker export -o test_centos-d.tar.gz centos-d</span></div><div class="line">[root@centos-docker docker]<span class="comment"># ls</span></div><div class="line">a.txt  b.txt  c.txt  epel-release-7-9.noarch.rpm  test_centos-d.tar.gz</div><div class="line">[root@centos-docker docker]<span class="comment"># docker export centos-d &gt;test2_centos-d.tar.gz</span></div><div class="line">[root@centos-docker docker]<span class="comment"># ls</span></div><div class="line">a.txt  b.txt  c.txt  epel-release-7-9.noarch.rpm  <span class="built_in">test</span>2_centos-d.tar.gz  test_centos-d.tar.gz</div></pre></td></tr></table></figure>
<p>实际上，既可以使用docker load命令来导入镜像存储文件到本地镜像库，也可以使用docker import命令来导入一个容器快照到本地镜像库。<br>这两者的区别在于容器快照文件将丢弃所有的历史记录和元数据信息（即仅保存容器当时的快照状态），而镜像存储文件将保存完整记录，体积也更大。此外，从容器快照文件导入时可以重新指定标签等元数据信息。</p>
<p>参考在此：<a href="https://read.douban.com/reader/ebook/30546100/" target="_blank" rel="external">Docker技术入门与实践</a><br><a href="https://read.douban.com/reader/ebook/17825949/" target="_blank" rel="external">Docker进阶与实战</a> 作者：华为Docker实践小组</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;初始容器与Docker&quot;&gt;&lt;a href=&quot;#初始容器与Docker&quot; class=&quot;headerlink&quot; title=&quot;初始容器与Docker&quot;&gt;&lt;/a&gt;初始容器与Docker&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/engine/docker-overview/&quot;&gt;https://docs.docker.com/engine/docker-overview/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;什么是Docker&quot;&gt;&lt;a href=&quot;#什么是Docker&quot; class=&quot;headerlink&quot; title=&quot;什么是Docker&quot;&gt;&lt;/a&gt;什么是Docker&lt;/h2&gt;&lt;h3 id=&quot;Docker开源项目背景&quot;&gt;&lt;a href=&quot;#Docker开源项目背景&quot; class=&quot;headerlink&quot; title=&quot;Docker开源项目背景&quot;&gt;&lt;/a&gt;Docker开源项目背景&lt;/h3&gt;&lt;p&gt;Docker是基于Go语言实现的开源容器项目，诞生于2013年年初，最初发起者是dotCloud公司。Docker自开源后受到广泛的关注和讨论，目前已有多个相关项目（包括Docker三剑客、Kubernetes等），逐渐形成了围绕Docker容器的生态体系。&lt;br&gt;由于Docker在业界造成的影响力实在太大，dotCloud公司后来也直接改名为Docker Inc，并专注于Docker相关技术和产品的开发。&lt;/p&gt;
&lt;p&gt;对于Docker，目前的定义是一个开源的容器引擎，可以方便地对容器（关于容器，将在第2章详细介绍）进行管理。其对镜像的打包封装，以及引入的Docker Registry对镜像的统一管理，构建了方便快捷的“Build，Ship and Run”流程，它可以统一整个开发、测试和部署的环境和流程，极大地减少运维成本。&lt;br&gt;
    
    </summary>
    
      <category term="Docker" scheme="https://itjinkui.github.io/categories/Docker/"/>
    
    
      <category term="Docker" scheme="https://itjinkui.github.io/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Linux</title>
    <link href="https://itjinkui.github.io/2017/05/25/systemd/"/>
    <id>https://itjinkui.github.io/2017/05/25/systemd/</id>
    <published>2017-05-25T09:59:57.000Z</published>
    <updated>2017-12-13T08:34:21.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Systemd-入门教程：命令篇"><a href="#Systemd-入门教程：命令篇" class="headerlink" title="Systemd 入门教程：命令篇"></a>Systemd 入门教程：命令篇</h1><p>Systemd 是 Linux 系统工具，用来启动<a href="http://www.ruanyifeng.com/blog/2016/02/linux-daemon.html" target="_blank" rel="external">守护进程</a>，已成为大多数发行版的标准配置。</p>
<p>本文介绍它的基本用法，分为上下两篇。今天介绍它的主要命令，下一篇介绍如何用于实战。</p>
<a id="more"></a>
<h2 id="一、由来"><a href="#一、由来" class="headerlink" title="一、由来"></a>一、由来</h2><p>历史上，<a href="http://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html" target="_blank" rel="external">Linux 的启动</a>一直采用<a href="https://en.wikipedia.org/wiki/Init" target="_blank" rel="external"><code>init</code></a>进程。</p>
<p>下面的命令用来启动服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost /]<span class="comment"># service httpd start</span></div><div class="line">Redirecting to /bin/systemctl start  httpd.service</div></pre></td></tr></table></figure>
<p>ps:Centos7已经不支持了喔！</p>
<p>这种方法有两个缺点。</p>
<p>一是启动时间长。<code>init</code>进程是串行启动，只有前一个进程启动完，才会启动下一个进程。</p>
<p>二是启动脚本复杂。<code>init</code>进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。</p>
<h2 id="二、Systemd-概述"><a href="#二、Systemd-概述" class="headerlink" title="二、Systemd 概述"></a>二、Systemd 概述</h2><p>Systemd 就是为了解决这些问题而诞生的。它的设计目标是，为系统的启动和管理提供一套完整的解决方案。</p>
<p>根据 Linux 惯例，字母<code>d</code>是守护进程（daemon）的缩写。 Systemd 这个名字的含义，就是它要守护整个系统。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016030702.jpg" alt=""></p>
<p>（上图为 Systemd 作者 <a href="https://en.wikipedia.org/wiki/Lennart_Poettering" target="_blank" rel="external">Lennart Poettering</a>）</p>
<p>使用了 Systemd，就不需要再用<code>init</code>了。Systemd 取代了<code>initd</code>，成为系统的第一个进程（PID 等于 1），其他进程都是它的子进程。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ systemctl --version</div></pre></td></tr></table></figure>
<p>上面的命令查看 Systemd 的版本。</p>
<p>Systemd 的优点是功能强大，使用方便，缺点是系统庞大，非常复杂。事实上，现在还有很多人反对使用 Systemd，理由就是它过于复杂，与操作系统的其他部分强耦合，违反“keep simple, keep stupid”的<a href="http://www.ruanyifeng.com/blog/2009/06/unix_philosophy.html" target="_blank" rel="external">Unix 哲学</a>。</p>
<p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016030703.png" alt=""></p>
<p>（上图为 Systemd 架构图）</p>
<h2 id="三、系统管理"><a href="#三、系统管理" class="headerlink" title="三、系统管理"></a>三、系统管理</h2><p>Systemd 并不是一个命令，而是一组命令，涉及到系统管理的方方面面。</p>
<h3 id="3-1-systemctl"><a href="#3-1-systemctl" class="headerlink" title="3.1 systemctl"></a>3.1 systemctl</h3><p><code>systemctl</code>是 Systemd 的主命令，用于管理系统。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 重启系统</span></div><div class="line">$ sudo systemctl reboot</div><div class="line"></div><div class="line"><span class="comment"># 关闭系统，切断电源</span></div><div class="line">$ sudo systemctl poweroff</div><div class="line"></div><div class="line"><span class="comment"># CPU停止工作</span></div><div class="line">$ sudo systemctl halt</div><div class="line"></div><div class="line"><span class="comment"># 暂停系统</span></div><div class="line">$ sudo systemctl <span class="built_in">suspend</span></div><div class="line"></div><div class="line"><span class="comment"># 让系统进入冬眠状态</span></div><div class="line">$ sudo systemctl hibernate</div><div class="line"></div><div class="line"><span class="comment"># 让系统进入交互式休眠状态</span></div><div class="line">$ sudo systemctl hybrid-sleep</div><div class="line"></div><div class="line"><span class="comment"># 启动进入救援状态（单用户状态）</span></div><div class="line">$ sudo systemctl rescue</div></pre></td></tr></table></figure>
<h3 id="3-2-systemd-analyze"><a href="#3-2-systemd-analyze" class="headerlink" title="3.2 systemd-analyze"></a>3.2 systemd-analyze</h3><p><code>systemd-analyze</code>命令用于查看启动耗时。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看启动耗时</span></div><div class="line">$ systemd-analyze                                                                                       </div><div class="line"></div><div class="line"><span class="comment"># 查看每个服务的启动耗时</span></div><div class="line">$ systemd-analyze blame</div><div class="line"></div><div class="line"><span class="comment"># 显示瀑布状的启动过程流</span></div><div class="line">$ systemd-analyze critical-chain</div><div class="line"></div><div class="line"><span class="comment"># 显示指定服务的启动流(eg:sshd.service)</span></div><div class="line">$ systemd-analyze critical-chain sshd.service</div></pre></td></tr></table></figure>
<h3 id="3-3-hostnamectl"><a href="#3-3-hostnamectl" class="headerlink" title="3.3 hostnamectl"></a>3.3 hostnamectl</h3><p><code>hostnamectl</code>命令用于查看当前主机的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示当前主机的信息</span></div><div class="line">$ hostnamectl</div><div class="line"></div><div class="line"><span class="comment"># 设置主机名。</span></div><div class="line">$ sudo hostnamectl <span class="built_in">set</span>-hostname CentOS-Docker</div></pre></td></tr></table></figure>
<h3 id="3-4-localectl"><a href="#3-4-localectl" class="headerlink" title="3.4 localectl"></a>3.4 localectl</h3><p><code>localectl</code>命令用于查看本地化设置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看本地化设置</span></div><div class="line">$ localectl</div><div class="line"></div><div class="line"><span class="comment"># 设置本地化参数。</span></div><div class="line">$ sudo localectl <span class="built_in">set</span>-locale LANG=zh_CN.UTF-8</div><div class="line">$ sudo localectl <span class="built_in">set</span>-keymap cn</div></pre></td></tr></table></figure>
<h3 id="3-5-timedatectl"><a href="#3-5-timedatectl" class="headerlink" title="3.5 timedatectl"></a>3.5 timedatectl</h3><p><code>timedatectl</code>命令用于查看当前时区设置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看当前时区设置</span></div><div class="line">$ timedatectl</div><div class="line"></div><div class="line"><span class="comment"># 显示所有可用的时区</span></div><div class="line">$ timedatectl list-timezones                                                                                   </div><div class="line"></div><div class="line"><span class="comment"># 设置当前时区</span></div><div class="line">$ sudo timedatectl <span class="built_in">set</span>-timezone America/New_York</div></pre></td></tr></table></figure>
<h3 id="3-6-loginctl"><a href="#3-6-loginctl" class="headerlink" title="3.6 loginctl"></a>3.6 loginctl</h3><p><code>loginctl</code>命令用于查看当前登录的用户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 列出当前session</span></div><div class="line">$ loginctl list-sessions</div><div class="line"></div><div class="line"><span class="comment"># 列出当前登录用户</span></div><div class="line">$ loginctl list-users</div><div class="line"></div><div class="line"><span class="comment"># 列出显示指定用户的信息</span></div><div class="line">$ loginctl show-user root</div></pre></td></tr></table></figure>
<h2 id="四、Unit"><a href="#四、Unit" class="headerlink" title="四、Unit"></a>四、Unit</h2><h3 id="4-1-含义"><a href="#4-1-含义" class="headerlink" title="4.1 含义"></a>4.1 含义</h3><p>Systemd 可以管理所有系统资源。不同的资源统称为 Unit（单位）。</p>
<p>Unit 一共分成12种。</p>
<blockquote>
<ul>
<li>Service unit：系统服务</li>
<li>Target unit：多个 Unit 构成的一个组</li>
<li>Device Unit：硬件设备</li>
<li>Mount Unit：文件系统的挂载点</li>
<li>Automount Unit：自动挂载点</li>
<li>Path Unit：文件或路径</li>
<li>Scope Unit：不是由 Systemd 启动的外部进程</li>
<li>Slice Unit：进程组</li>
<li>Snapshot Unit：Systemd 快照，可以切回某个快照</li>
<li>Socket Unit：进程间通信的 socket</li>
<li>Swap Unit：swap 文件</li>
<li>Timer Unit：定时器</li>
</ul>
</blockquote>
<p><code>systemctl list-units</code>命令可以查看当前系统的所有 Unit 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 列出正在运行的 Unit</span></div><div class="line">$ systemctl list-units</div><div class="line"></div><div class="line"><span class="comment"># 列出所有Unit，包括没有找到配置文件的或者启动失败的</span></div><div class="line">$ systemctl list-units --all</div><div class="line"></div><div class="line"><span class="comment"># 列出所有没有运行的 Unit</span></div><div class="line">$ systemctl list-units --all --state=inactive</div><div class="line"></div><div class="line"><span class="comment"># 列出所有加载失败的 Unit</span></div><div class="line">$ systemctl list-units --failed</div><div class="line"></div><div class="line"><span class="comment"># 列出所有正在运行的、类型为 service 的 Unit</span></div><div class="line">$ systemctl list-units --type=service</div></pre></td></tr></table></figure>
<h3 id="4-2-Unit-的状态"><a href="#4-2-Unit-的状态" class="headerlink" title="4.2 Unit 的状态"></a>4.2 Unit 的状态</h3><p><code>systemctl status</code>命令用于查看系统状态和单个 Unit 的状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示系统状态</span></div><div class="line">$ systemctl status</div><div class="line"></div><div class="line"><span class="comment"># 显示单个 Unit 的状态</span></div><div class="line">$ sysystemctl status httpd.service</div><div class="line"></div><div class="line"><span class="comment"># 显示远程主机的某个 Unit 的状态</span></div><div class="line">$ systemctl -H root@rhel7.example.com status httpd.service</div></pre></td></tr></table></figure>
<p>除了<code>status</code>命令，<code>systemctl</code>还提供了三个查询状态的简单方法，主要供脚本内部的判断语句使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 显示某个 Unit 是否正在运行</span></div><div class="line">$ systemctl is-active httpd.service</div><div class="line"></div><div class="line"><span class="comment"># 显示某个 Unit 是否处于启动失败状态</span></div><div class="line">$ systemctl is-failed httpd.service</div><div class="line"></div><div class="line"><span class="comment"># 显示某个 Unit 服务是否建立了启动链接</span></div><div class="line">$ systemctl is-enabled httpd.service</div></pre></td></tr></table></figure>
<h3 id="4-3-Unit-管理"><a href="#4-3-Unit-管理" class="headerlink" title="4.3 Unit 管理"></a>4.3 Unit 管理</h3><p>对于用户来说，最常用的是下面这些命令，用于启动和停止 Unit（主要是 service）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 立即启动一个服务</span></div><div class="line">$ sudo systemctl start httpd.service</div><div class="line"><span class="comment"># 立即停止一个服务</span></div><div class="line">$ sudo systemctl stop httpd.service</div><div class="line"><span class="comment"># 重启一个服务</span></div><div class="line">$ sudo systemctl restart httpd.service</div><div class="line"><span class="comment"># 杀死一个服务的所有子进程</span></div><div class="line">$ sudo systemctl <span class="built_in">kill</span> httpd.service</div><div class="line"><span class="comment"># 重新加载一个服务的配置文件</span></div><div class="line">$ sudo systemctl reload httpd.service</div><div class="line"><span class="comment"># 重载所有修改过的配置文件</span></div><div class="line">$ sudo systemctl daemon-reload</div><div class="line"></div><div class="line"><span class="comment"># 显示某个 Unit 的所有底层参数</span></div><div class="line">$ systemctl show httpd.service</div><div class="line"></div><div class="line"><span class="comment"># 显示某个 Unit 的指定属性的值</span></div><div class="line">$ systemctl show -p CPUShares httpd.service</div></pre></td></tr></table></figure>
<h3 id="4-4-依赖关系"><a href="#4-4-依赖关系" class="headerlink" title="4.4 依赖关系"></a>4.4 依赖关系</h3><p>Unit 之间存在依赖关系：A 依赖于 B，就意味着 Systemd 在启动 A 的时候，同时会去启动 B。</p>
<p><code>systemctl list-dependencies</code>命令列出一个 Unit 的所有依赖。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ systemctl list-dependencies nginx.service</div></pre></td></tr></table></figure>
<p>上面命令的输出结果之中，有些依赖是 Target 类型（详见下文），默认不会展开显示。如果要展开 Target，就需要使用<code>--all</code>参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ systemctl list-dependencies --all nginx.service</div></pre></td></tr></table></figure>
<h2 id="五、Unit-的配置文件"><a href="#五、Unit-的配置文件" class="headerlink" title="五、Unit 的配置文件"></a>五、Unit 的配置文件</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>每一个 Unit 都有一个配置文件，告诉 Systemd 怎么启动这个 Unit 。</p>
<p>Systemd 默认从目录<code>/etc/systemd/system/</code>读取配置文件。但是，里面存放的大部分文件都是符号链接，指向目录<code>/usr/lib/systemd/system/</code>，真正的配置文件存放在这个目录。</p>
<p><code>systemctl enable</code>命令用于在上面两个目录之间，建立符号链接关系。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl <span class="built_in">enable</span> sshd.service</div><div class="line"><span class="comment"># 等同于</span></div><div class="line">$ sudo ln <span class="_">-s</span> <span class="string">'/usr/lib/systemd/system/sshd.service'</span> <span class="string">'/etc/systemd/system/multi-user.target.wants/sshd.service'</span></div></pre></td></tr></table></figure>
<p>如果配置文件里面设置了开机启动，<code>systemctl enable</code>命令相当于激活开机启动。</p>
<p>与之对应的，<code>systemctl disable</code>命令用于在两个目录之间，撤销符号链接关系，相当于撤销开机启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl <span class="built_in">disable</span> sshd.service</div></pre></td></tr></table></figure>
<p>配置文件的后缀名，就是该 Unit 的种类，比如<code>sshd.socket</code>。如果省略，Systemd 默认后缀名为<code>.service</code>，所以<code>sshd</code>会被理解成<code>sshd.service</code>。</p>
<h3 id="5-2-配置文件的状态"><a href="#5-2-配置文件的状态" class="headerlink" title="5.2 配置文件的状态"></a>5.2 配置文件的状态</h3><p><code>systemctl list-unit-files</code>命令用于列出所有配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 列出所有配置文件</span></div><div class="line">$ systemctl list-unit-files</div><div class="line"></div><div class="line"><span class="comment"># 列出指定类型的配置文件</span></div><div class="line">$ systemctl list-unit-files --type=service</div></pre></td></tr></table></figure>
<p>这个命令会输出一个列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ systemctl list-unit-files</div><div class="line"></div><div class="line">UNIT FILE              STATE</div><div class="line">chronyd.service        enabled</div><div class="line">clamd@.service         static</div><div class="line">sshd.service     disabled</div></pre></td></tr></table></figure>
<p>这个列表显示每个配置文件的状态，一共有四种。</p>
<blockquote>
<ul>
<li>enabled：已建立启动链接</li>
<li>disabled：没建立启动链接</li>
<li>static：该配置文件没有<code>[Install]</code>部分（无法执行），只能作为其他配置文件的依赖</li>
<li>masked：该配置文件被禁止建立启动链接</li>
</ul>
</blockquote>
<p>注意，从配置文件的状态无法看出，该 Unit 是否正在运行。这必须执行前面提到的<code>systemctl status</code>命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ systemctl status httpd.service</div></pre></td></tr></table></figure>
<p>一旦修改配置文件，就要让 Systemd 重新加载配置文件，然后重新启动，否则修改不会生效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl daemon-reload</div><div class="line">$ sudo systemctl restart httpd.service</div></pre></td></tr></table></figure>
<h3 id="5-3-配置文件的格式"><a href="#5-3-配置文件的格式" class="headerlink" title="5.3 配置文件的格式"></a>5.3 配置文件的格式</h3><p>配置文件就是普通的文本文件，可以用文本编辑器打开。</p>
<p><code>systemctl cat</code>命令可以查看配置文件的内容。<br>注意，配置文件的区块名和字段名，都是大小写敏感的。</p>
<p>每个区块内部是一些等号连接的键值对。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[Section]</div><div class="line">Directive1=value</div><div class="line">Directive2=value</div><div class="line"></div><div class="line">. . .</div></pre></td></tr></table></figure>
<p>注意，键值对的等号两侧不能有空格。</p>
<h3 id="5-4-配置文件的区块"><a href="#5-4-配置文件的区块" class="headerlink" title="5.4 配置文件的区块"></a>5.4 配置文件的区块</h3><p><code>[Unit]</code>区块通常是配置文件的第一个区块，用来定义 Unit 的元数据，以及配置与其他 Unit 的关系。它的主要字段如下。</p>
<blockquote>
<ul>
<li><code>Description</code>：简短描述</li>
<li><code>Documentation</code>：文档地址</li>
<li><code>Requires</code>：当前 Unit 依赖的其他 Unit，如果它们没有运行，当前 Unit 会启动失败</li>
<li><code>Wants</code>：与当前 Unit 配合的其他 Unit，如果它们没有运行，当前 Unit 不会启动失败</li>
<li><code>BindsTo</code>：与<code>Requires</code>类似，它指定的 Unit 如果退出，会导致当前 Unit 停止运行</li>
<li><code>Before</code>：如果该字段指定的 Unit 也要启动，那么必须在当前 Unit 之后启动</li>
<li><code>After</code>：如果该字段指定的 Unit 也要启动，那么必须在当前 Unit 之前启动</li>
<li><code>Conflicts</code>：这里指定的 Unit 不能与当前 Unit 同时运行</li>
<li><code>Condition...</code>：当前 Unit 运行必须满足的条件，否则不会运行</li>
<li><code>Assert...</code>：当前 Unit 运行必须满足的条件，否则会报启动失败</li>
</ul>
</blockquote>
<p><code>[Install]</code>通常是配置文件的最后一个区块，用来定义如何启动，以及是否开机启动。它的主要字段如下。</p>
<blockquote>
<ul>
<li><code>WantedBy</code>：它的值是一个或多个 Target，当前 Unit 激活时（enable）符号链接会放入<code>/etc/systemd/system</code>目录下面以 Target 名 + <code>.wants</code>后缀构成的子目录中</li>
<li><code>RequiredBy</code>：它的值是一个或多个 Target，当前 Unit 激活时，符号链接会放入<code>/etc/systemd/system</code>目录下面以 Target 名 + <code>.required</code>后缀构成的子目录中</li>
<li><code>Alias</code>：当前 Unit 可用于启动的别名</li>
<li><code>Also</code>：当前 Unit 激活（enable）时，会被同时激活的其他 Unit</li>
</ul>
</blockquote>
<p><code>[Service]</code>区块用来 Service 的配置，只有 Service 类型的 Unit 才有这个区块。它的主要字段如下。</p>
<blockquote>
<ul>
<li><code>Type</code>：定义启动时的进程行为。它有以下几种值。<ul>
<li><code>simple</code>：默认值，执行<code>ExecStart</code>指定的命令，启动主进程</li>
<li><code>forking</code>：以 fork 方式从父进程创建子进程，创建后父进程会立即退出</li>
<li><code>oneshot</code>：一次性进程，Systemd 会等当前服务退出，再继续往下执行</li>
<li><code>dbus</code>：当前服务通过D-Bus启动</li>
<li><code>notify</code>：当前服务启动完毕，会通知<code>Systemd</code>，再继续往下执行</li>
<li><code>idle</code>：若有其他任务执行完毕，当前服务才会运行</li>
</ul>
</li>
<li><code>ExecStart</code>：启动当前服务的命令</li>
<li><code>ExecStartPre</code>：启动当前服务之前执行的命令</li>
<li><code>ExecStartPost</code>：启动当前服务之后执行的命令</li>
<li><code>ExecReload</code>：重启当前服务时执行的命令</li>
<li><code>ExecStop</code>：停止当前服务时执行的命令</li>
<li><code>ExecStopPost</code>：停止当其服务之后执行的命令</li>
<li><code>RestartSec</code>：自动重启当前服务间隔的秒数</li>
<li><code>Restart</code>：定义何种情况 Systemd 会自动重启当前服务，可能的值包括<code>always</code>（总是重启）、<code>on-success</code>、<code>on-failure</code>、<code>on-abnormal</code>、<code>on-abort</code>、<code>on-watchdog</code></li>
<li><code>TimeoutSec</code>：定义 Systemd 停止当前服务之前等待的秒数</li>
<li><code>Environment</code>：指定环境变量</li>
</ul>
</blockquote>
<p>Unit 配置文件的完整字段清单，请参考<a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html" target="_blank" rel="external">官方文档</a>。</p>
<h2 id="六、Target"><a href="#六、Target" class="headerlink" title="六、Target"></a>六、Target</h2><p>简单说，Target 就是一个 Unit 组，包含许多相关的 Unit 。启动某个 Target 的时候，Systemd 就会启动里面所有的 Unit。从这个意义上说，Target 这个概念类似于“状态点”，启动某个 Target 就好比启动到某种状态。</p>
<p>传统的<code>init</code>启动模式里面，有 RunLevel 的概念，跟 Target 的作用很类似。不同的是，RunLevel 是互斥的，不可能多个 RunLevel 同时启动，但是多个 Target 可以同时启动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看当前系统的所有 Target</span></div><div class="line">$ systemctl list-unit-files --type=target</div><div class="line"></div><div class="line"><span class="comment"># 查看一个 Target 包含的所有 Unit</span></div><div class="line">$ systemctl list-dependencies multi-user.target</div><div class="line"></div><div class="line"><span class="comment"># 查看启动时的默认 Target</span></div><div class="line">$ systemctl get-default</div><div class="line"></div><div class="line"><span class="comment"># 设置启动时的默认 Target</span></div><div class="line">$ sudo systemctl <span class="built_in">set</span>-default multi-user.target</div><div class="line"></div><div class="line"><span class="comment"># 切换 Target 时，默认不关闭前一个 Target 启动的进程，</span></div><div class="line"><span class="comment"># systemctl isolate 命令改变这种行为，</span></div><div class="line"><span class="comment"># 关闭前一个 Target 里面所有不属于后一个 Target 的进程</span></div><div class="line">$ sudo systemctl isolate multi-user.target</div></pre></td></tr></table></figure>
<p>Target 与 传统 RunLevel 的对应关系如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Traditional runlevel      New target name     Symbolically linked to...</div><div class="line"></div><div class="line">Runlevel 0           |    runlevel0.target -&gt; poweroff.target</div><div class="line">Runlevel 1           |    runlevel1.target -&gt; rescue.target</div><div class="line">Runlevel 2           |    runlevel2.target -&gt; multi-user.target</div><div class="line">Runlevel 3           |    runlevel3.target -&gt; multi-user.target</div><div class="line">Runlevel 4           |    runlevel4.target -&gt; multi-user.target</div><div class="line">Runlevel 5           |    runlevel5.target -&gt; graphical.target</div><div class="line">Runlevel 6           |    runlevel6.target -&gt; reboot.target</div></pre></td></tr></table></figure>
<p>它与<code>init</code>进程的主要差别如下。</p>
<blockquote>
<p><strong>（1）默认的 RunLevel</strong>（在<code>/etc/inittab</code>文件设置）现在被默认的 Target 取代，位置是<code>/etc/systemd/system/default.target</code>，通常符号链接到<code>graphical.target</code>（图形界面）或者<code>multi-user.target</code>（多用户命令行）。</p>
<p><strong>（2）启动脚本的位置</strong>，以前是<code>/etc/init.d</code>目录，符号链接到不同的 RunLevel 目录 （比如<code>/etc/rc3.d</code>、<code>/etc/rc5.d</code>等），现在则存放在<code>/lib/systemd/system</code>和<code>/etc/systemd/system</code>目录。</p>
<p><strong>（3）配置文件的位置</strong>，以前<code>init</code>进程的配置文件是<code>/etc/inittab</code>，各种服务的配置文件存放在<code>/etc/sysconfig</code>目录。现在的配置文件主要存放在<code>/lib/systemd</code>目录，在<code>/etc/systemd</code>目录里面的修改可以覆盖原始设置。</p>
</blockquote>
<h2 id="七、日志管理"><a href="#七、日志管理" class="headerlink" title="七、日志管理"></a>七、日志管理</h2><p>Systemd 统一管理所有 Unit 的启动日志。带来的好处就是，可以只用<code>journalctl</code>一个命令，查看所有日志（内核日志和应用日志）。日志的配置文件是<code>/etc/systemd/journald.conf</code>。</p>
<p><code>journalctl</code>功能强大，用法非常多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看所有日志（默认情况下 ，只保存本次启动的日志）</span></div><div class="line">$ sudo journalctl</div><div class="line"></div><div class="line"><span class="comment"># 查看内核日志（不显示应用日志）</span></div><div class="line">$ sudo journalctl -k</div><div class="line"></div><div class="line"><span class="comment"># 查看系统本次启动的日志</span></div><div class="line">$ sudo journalctl -b</div><div class="line">$ sudo journalctl -b -0</div><div class="line"></div><div class="line"><span class="comment"># 查看上一次启动的日志（需更改设置）</span></div><div class="line">$ sudo journalctl -b -1</div><div class="line"></div><div class="line"><span class="comment"># 查看指定时间的日志</span></div><div class="line">$ sudo journalctl --since=<span class="string">"2012-10-30 18:17:16"</span></div><div class="line">$ sudo journalctl --since <span class="string">"20 min ago"</span></div><div class="line">$ sudo journalctl --since yesterday</div><div class="line">$ sudo journalctl --since 09:00 --until <span class="string">"1 hour ago"</span></div><div class="line"></div><div class="line"><span class="comment"># 显示尾部的最新10行日志</span></div><div class="line">$ sudo journalctl -n</div><div class="line"></div><div class="line"><span class="comment"># 显示尾部指定行数的日志</span></div><div class="line">$ sudo journalctl -n 20</div><div class="line"></div><div class="line"><span class="comment"># 实时滚动显示最新日志</span></div><div class="line">$ sudo journalctl <span class="_">-f</span></div><div class="line"></div><div class="line"><span class="comment"># 查看指定服务的日志</span></div><div class="line">$ sudo journalctl /usr/lib/systemd/systemd</div><div class="line"></div><div class="line"><span class="comment"># 查看指定进程的日志</span></div><div class="line">$ sudo journalctl _PID=1</div><div class="line"></div><div class="line"><span class="comment"># 查看某个路径的脚本的日志</span></div><div class="line">$ sudo journalctl /usr/bin/bash</div><div class="line"></div><div class="line"><span class="comment"># 查看指定用户的日志</span></div><div class="line">$ sudo journalctl _UID=33 --since today</div><div class="line"></div><div class="line"><span class="comment"># 查看某个 Unit 的日志</span></div><div class="line">$ sudo journalctl -u nginx.service</div><div class="line">$ sudo journalctl -u nginx.service --since today</div><div class="line"></div><div class="line"><span class="comment"># 实时滚动显示某个 Unit 的最新日志</span></div><div class="line">$ sudo journalctl -u nginx.service <span class="_">-f</span></div><div class="line"></div><div class="line"><span class="comment"># 合并显示多个 Unit 的日志</span></div><div class="line">$ journalctl -u nginx.service -u php-fpm.service --since today</div><div class="line"></div><div class="line"><span class="comment"># 查看指定优先级（及其以上级别）的日志，共有8级</span></div><div class="line"><span class="comment"># 0: emerg</span></div><div class="line"><span class="comment"># 1: alert</span></div><div class="line"><span class="comment"># 2: crit</span></div><div class="line"><span class="comment"># 3: err</span></div><div class="line"><span class="comment"># 4: warning</span></div><div class="line"><span class="comment"># 5: notice</span></div><div class="line"><span class="comment"># 6: info</span></div><div class="line"><span class="comment"># 7: debug</span></div><div class="line">$ sudo journalctl -p err -b</div><div class="line"></div><div class="line"><span class="comment"># 日志默认分页输出，--no-pager 改为正常的标准输出</span></div><div class="line">$ sudo journalctl --no-pager</div><div class="line"></div><div class="line"><span class="comment"># 以 JSON 格式（单行）输出</span></div><div class="line">$ sudo journalctl -b -u nginx.service -o json</div><div class="line"></div><div class="line"><span class="comment"># 以 JSON 格式（多行）输出，可读性更好</span></div><div class="line">$ sudo journalctl -b -u nginx.service -o json-pretty</div><div class="line"></div><div class="line"><span class="comment"># 显示日志占据的硬盘空间</span></div><div class="line">$ sudo journalctl --disk-usage</div><div class="line"></div><div class="line"><span class="comment"># 指定日志文件占据的最大空间</span></div><div class="line">$ sudo journalctl --vacuum-size=1G</div><div class="line"></div><div class="line"><span class="comment"># 指定日志文件保存多久</span></div><div class="line">$ sudo journalctl --vacuum-time=1years</div></pre></td></tr></table></figure>
<h2 id="八、结语"><a href="#八、结语" class="headerlink" title="八、结语"></a>八、结语</h2><p>转载于<a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></p>
<p>引申阅读：</p>
<ul>
<li><a href="http://coolshell.cn/articles/17998.html" target="_blank" rel="external">LINUX PID 1 和 SYSTEMD</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Systemd-入门教程：命令篇&quot;&gt;&lt;a href=&quot;#Systemd-入门教程：命令篇&quot; class=&quot;headerlink&quot; title=&quot;Systemd 入门教程：命令篇&quot;&gt;&lt;/a&gt;Systemd 入门教程：命令篇&lt;/h1&gt;&lt;p&gt;Systemd 是 Linux 系统工具，用来启动&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/02/linux-daemon.html&quot;&gt;守护进程&lt;/a&gt;，已成为大多数发行版的标准配置。&lt;/p&gt;
&lt;p&gt;本文介绍它的基本用法，分为上下两篇。今天介绍它的主要命令，下一篇介绍如何用于实战。&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://itjinkui.github.io/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://itjinkui.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>git</title>
    <link href="https://itjinkui.github.io/2017/05/11/git-how/"/>
    <id>https://itjinkui.github.io/2017/05/11/git-how/</id>
    <published>2017-05-11T09:57:29.000Z</published>
    <updated>2017-06-19T07:21:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>#Git 闲话</p>
<blockquote>
<p>1、最近阅读《数学之美》、《浪潮之巅》惊叹于大神的眼界、文化功底，所以就在得到专栏上订阅了吴军博士的硅谷来信。总之，就是膜拜了。想了解一个人，就先了解一个的思想对不对，所谓见贤与之思齐就是这样了。<br>2、接下来说一说我心目中的另一位大神 林纳斯•托瓦兹，编程界公认的啊。<br>“我不是个有远见的人，我是一名工程师，”托瓦兹说，“我非常乐意跟梦想家在一起，他们行走四方，仰望苍穹……但我是低头看路的那种人，我只想填好眼前这个坑，不让自己掉进去。“<br>只干了两件事啊，毫不夸张的说：惊天地泣鬼神。<br>第一件是开发出Linux内核，驱动了因特网，第二件是开发出Git，一种源代码管理系统，被全世界开发者广泛使用。<br>再接下来，Git 就是我们的主题了，记录以备忘。</p>
</blockquote>
<a id="more"></a>
<h2 id="Git安装与配置"><a href="#Git安装与配置" class="headerlink" title="Git安装与配置"></a>Git安装与配置</h2><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>Mac 上brew安装算是最便捷的了</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~ brew install git </div><div class="line">~ brew --version</div><div class="line">Homebrew 1.1.13</div><div class="line">Homebrew/homebrew-core (git revision ea163; last commit 2017-04-20)</div><div class="line">~ git --version</div><div class="line">git version 2.11.0</div></pre></td></tr></table></figure>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>可以通过 git config –list –global 命令来查看：</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~ git config --list --global</div><div class="line">user.email=1250114609@qq.com</div><div class="line">user.name=千古不见一人闲</div><div class="line">color.ui=auto</div><div class="line">alias.st=status</div><div class="line">alias.lg=<span class="built_in">log</span> --color --graph --pretty=format:<span class="string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span> --abbrev-commit</div></pre></td></tr></table></figure>
<p>可以看到有两个alias出现，这里使用了别名。</p>
<p>配置别名</p>
<p>这个功能在shell中是很常用的。我们可以做一些别名来取代比较复杂的指令。<br>比如上面就是使用了以下两个配置</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">~ git config --global alias.st status</div><div class="line"></div><div class="line">~ git config --global alias.lg <span class="string">"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span></div></pre></td></tr></table></figure>
<h4 id="身份认证"><a href="#身份认证" class="headerlink" title="身份认证"></a>身份认证</h4><p>当本地git仓库与git远程仓库通信的时候，需要进行SSH身份认证。<br>打开根目录下的.ssh目录：</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~/.ssh la</div><div class="line">.              ..             config         github_rsa     github_rsa.pub id_rsa         id_rsa.pub     known_hosts</div></pre></td></tr></table></figure>
<p>如果没有id_rsa和id_rsa.pub这两个文件，就通过如下的命令生成：</p>
<p>ssh-keygen -t rsa -C “youremail@example.com”<br>id_rsa和id_rsa.pub这两个文件，就是SSH Key的秘钥对，id_rsa是私钥，id_rsa.pub是公钥，用在github上表明身份。<br>在GitHub上的SSH keys中添加刚刚生成的key。(id_rsa.pub)</p>
<h4 id="创建Git仓库"><a href="#创建Git仓库" class="headerlink" title="创建Git仓库"></a>创建Git仓库</h4><p>创建一个目录，并cd到目录下，通过调用git init来将现有目录初始化为git仓库，或者直接在git init后面跟上目录名，同样也可以创建一个新的仓库。</p>
<p>git clone 直接clone一个远程仓库也是可以的。</p>
<h4 id="提交修改"><a href="#提交修改" class="headerlink" title="提交修改"></a>提交修改</h4><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">~/Documents/workspace git_springboot</div><div class="line">~/Documents/workspace/git_springboot(master ✔) la</div><div class="line">.    ..   .git</div><div class="line">~/Documents/workspace/git_springboot(master ✔) touch README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✗) vim README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✗) git add README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✗) git commit -m <span class="string">"add README.md"</span></div><div class="line">[master be9081a] add README.md</div><div class="line"> 1 file changed, 1 insertion(+)</div><div class="line"> create mode 100644 README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✔)</div></pre></td></tr></table></figure>
<h4 id="查看修改"><a href="#查看修改" class="headerlink" title="查看修改"></a>查看修改</h4><p>修改README.md文件，git st查看修改</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">~/Documents/workspace/git_springboot(master ✗) git st</div><div class="line">On branch master</div><div class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 1 commit.</div><div class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</div><div class="line">Changes not staged <span class="keyword">for</span> commit:</div><div class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</div><div class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</div><div class="line"></div><div class="line">        modified:   README.md</div><div class="line"></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div></pre></td></tr></table></figure>
<p>Git 比较不同版本文件差异的常用命令格式：</p>
<blockquote>
<p>git diff  查看尚未暂存的文件更新了哪些部分      </p>
<p>git diff filename 查看尚未暂存的某个文件更新了哪些</p>
<p>git diff –cached 查看已经暂存起来的文件和上次提交的版本之间的差异</p>
<p>git diff –cached filename 查看已经暂存起来的某个文件和上次提交的版本之间的差异</p>
</blockquote>
<p>使用git diff README.md 命令看一下修改的具体内容</p>
<blockquote>
<p>diff –git a/README.md b/README.md<br>index e8281cd..f1729fb 100644<br>— a/README.md<br>+++ b/README.md<br>@@ -1 +1 @@<br>-this’s ok.<br>+this’s ok,modify.</p>
</blockquote>
<p>add和commit之后，我们都使用status来查看下状态，可以发现，在commit之后，git提示我们，工作区是干净的。</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">~/Documents/workspace/git_springboot(master ✗) git st</div><div class="line">On branch master</div><div class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 1 commit.</div><div class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</div><div class="line">Changes not staged <span class="keyword">for</span> commit:</div><div class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</div><div class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</div><div class="line"></div><div class="line">        modified:   README.md</div><div class="line"></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div><div class="line">~/Documents/workspace/git_springboot(master ✗) git add README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✗) git commit -m <span class="string">"modify README.md"</span></div><div class="line">[master a77107b] modify README.md</div><div class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</div><div class="line">~/Documents/workspace/git_springboot(master ✔) git st</div><div class="line">On branch master</div><div class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 2 commits.</div><div class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</div><div class="line">nothing to commit, working tree clean</div></pre></td></tr></table></figure>
<h4 id="版本记录"><a href="#版本记录" class="headerlink" title="版本记录"></a>版本记录</h4><p>使用git lg 命令来查看<br>也可以使用gitk命令来查看图形化的log记录</p>
<h4 id="工作区与暂存区"><a href="#工作区与暂存区" class="headerlink" title="工作区与暂存区"></a>工作区与暂存区</h4><p>Git通常是工作在三个区域上：</p>
<p>工作区<br>暂存区<br>历史区<br>其中工作区就是我们平时工作、修改代码的区域；而历史区，用来保存各个版本；而暂存区，则是Git的核心所在。<br><a href="https://git-scm.com/" target="_blank" rel="external">Git官网</a><br><a href="http://marklodato.github.io/visual-git-guide/index-zh-cn.html" target="_blank" rel="external">图解Git</a></p>
<h4 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h4><p>回退版本是必不可少的操作啊</p>
<p>我们来考虑以下常见的几种情况：</p>
<ol>
<li>文件已经修改，但是还没有git add</li>
<li>文件已经add到暂存区，又作了修改</li>
<li>文件的修改已经add到了暂存区</li>
</ol>
<p>分别执行以下操作：</p>
<p>➜git checkout – README.md<br>修改被删除，完全还原到上次commit的状态，也就是服务器版本(1.)<br>最后的修改被删除，还原到上次add的状态，也就是修改前的暂存区状态(2.)<br>➜git reset HEAD README.md(3.)</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">~/Documents/workspace/git_springboot(master ✗) git st</div><div class="line">On branch master</div><div class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 2 commits.</div><div class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</div><div class="line">Changes to be committed:</div><div class="line">  (use <span class="string">"git reset HEAD &lt;file&gt;..."</span> to unstage)</div><div class="line"></div><div class="line">        modified:   README.md</div><div class="line"></div><div class="line">~/Documents/workspace/git_springboot(master ✗) git reset HEAD README.md</div><div class="line">Unstaged changes after reset:</div><div class="line">M       README.md</div><div class="line">~/Documents/workspace/git_springboot(master ✗) git st</div><div class="line">On branch master</div><div class="line">Your branch is ahead of <span class="string">'origin/master'</span> by 2 commits.</div><div class="line">  (use <span class="string">"git push"</span> to publish your <span class="built_in">local</span> commits)</div><div class="line">Changes not staged <span class="keyword">for</span> commit:</div><div class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</div><div class="line">  (use <span class="string">"git checkout -- &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</div><div class="line"></div><div class="line">        modified:   README.md</div><div class="line"></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div></pre></td></tr></table></figure>
<p>通过git reset HEAD README.md，我们就把暂存区的文件清除了。这样，在本地就是add前的状态，通过checkout操作，就可以进行修改回退了。<br>在Git中，用HEAD表示当前版本，上一个版本就是<code>HEAD^</code>，<br>上上一个版本就是<code>HEAD^^</code>。（git reset –hard HEAD）<br>要回退到哪个版本，也可以写commit id。</p>
<h4 id="前进版本"><a href="#前进版本" class="headerlink" title="前进版本"></a>前进版本</h4><p>如果我们回退到了旧的版本，但是却后悔了想回到后面某个新的版本,git reflog 查看操作历史。找到 commit id。<br>版本号没必要写全，前7位就可以了，Git会自动去找。</p>
<h4 id="文件暂存"><a href="#文件暂存" class="headerlink" title="文件暂存"></a>文件暂存</h4><p>这里的暂存不是前面说的暂存区，而是只一次备份与恢复操作。<br>git stash<br>指令来将当前修改暂存，这样就可以切换到其他分支或者就在当前干净的分支上checkout了。<br>比如你checkout了一个issue分支，修改了bug，使用git merge合并到了master分支，删除issue分支，切换到dev分支，想继续之前的新功能开发。<br>这时候，就需要恢复现场了：</p>
<p>git stash list<br>指令来查看当前暂存的内容记录。<br>然后，通过git stash apply或者git stash pop来进行恢复，它们的区别是，前者不会删除记录（当然你可以使用git stash drop来删除），而后者会。</p>
<h4 id="远程仓库-amp-同步协作"><a href="#远程仓库-amp-同步协作" class="headerlink" title="远程仓库&amp;同步协作"></a>远程仓库&amp;同步协作</h4><p>现在你在本地建立了git仓库，想与远程git仓库同步。</p>
<p>我们先在github上创建一个repo（仓库），<br>创建之后，github给我们提示：<br><img src="git.png" alt="git_createrepository"><br>可以看出，执行以下指令就和远程仓库建立关联了，自然也就可以多人同步协作开发了。</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git remote add origin git@github.com:itjinkui/git_springboot.git</div><div class="line">git push -u origin master</div></pre></td></tr></table></figure>
<h4 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h4><p>git 入门操作算是完成了。企业可以通过GitLab搭建自己的版本管理系统。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#Git 闲话&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1、最近阅读《数学之美》、《浪潮之巅》惊叹于大神的眼界、文化功底，所以就在得到专栏上订阅了吴军博士的硅谷来信。总之，就是膜拜了。想了解一个人，就先了解一个的思想对不对，所谓见贤与之思齐就是这样了。&lt;br&gt;2、接下来说一说我心目中的另一位大神 林纳斯•托瓦兹，编程界公认的啊。&lt;br&gt;“我不是个有远见的人，我是一名工程师，”托瓦兹说，“我非常乐意跟梦想家在一起，他们行走四方，仰望苍穹……但我是低头看路的那种人，我只想填好眼前这个坑，不让自己掉进去。“&lt;br&gt;只干了两件事啊，毫不夸张的说：惊天地泣鬼神。&lt;br&gt;第一件是开发出Linux内核，驱动了因特网，第二件是开发出Git，一种源代码管理系统，被全世界开发者广泛使用。&lt;br&gt;再接下来，Git 就是我们的主题了，记录以备忘。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="git" scheme="https://itjinkui.github.io/categories/git/"/>
    
    
      <category term="git" scheme="https://itjinkui.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://itjinkui.github.io/2017/03/28/hello-world/"/>
    <id>https://itjinkui.github.io/2017/03/28/hello-world/</id>
    <published>2017-03-28T10:29:41.000Z</published>
    <updated>2017-05-11T08:59:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
